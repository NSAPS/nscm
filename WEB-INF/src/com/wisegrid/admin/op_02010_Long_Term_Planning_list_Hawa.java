package com.wisegrid.admin;                                                                                                                                                                                                                                                                                                                                                            import java.io.IOException;                                                                                                  import java.io.PrintWriter;                                                                                                  import java.sql.SQLException;                                                                                                import java.util.ArrayList;                                                                                                                                                                                                                               import javax.servlet.ServletException;                                                                                       import javax.servlet.http.HttpServlet;                                                                                       import javax.servlet.http.HttpServletRequest;                                                                                import javax.servlet.http.HttpServletResponse;                                                                                                                                                                                                            import com.zionex.t3sinc.common.CommonUtil;                                                                                  import xlib.cmc.GridData;                                                                                                    import xlib.cmc.OperateGridData;                                                                                                                                                                                                                                                                                                                                                       import java.sql.Connection;                                                                                                  import java.sql.ResultSet;                                                                                                   import java.sql.Statement;                                                                                                   import java.util.HashMap;                                                                                                    import java.util.Iterator;                                                                                                   import java.util.LinkedList;                                                                                                 import java.util.Map;                                                                                                                                                                                                                                     import com.zionex.t3sinc.util.db.SincDatabaseUtility;                                                                        /**                                                                                                                           *                                                                                                                            * @author iCOMPIA CORP.                                                                                                      */                                                                                                                          public class op_02010_Long_Term_Planning_list_Hawa extends HttpServlet {                                                                                                                                                                                          	private static final long serialVersionUID = -419201700278107216L;                                                       	                                                                                                                         	Connection 	conn 	= null;                                                                                              	Statement 	stmt	= null;                                                                                              	ResultSet	rs		= null;	                                                                                             	String 		sql 	= null;                                                                                              	//Map sessionMap 	= new HashMap();                                                                                     	                                                                                                                         	SincDatabaseUtility databaseUtility = new SincDatabaseUtility();	                                                                                                                                                                                  	public void doPost(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {               		GridData gdReq = null;                                                                                               		GridData gdRes = null;                                                                                                                                                                                                                                    System.out.println("START...");                                                                                                                                                                                                                   		// Encode Type; UTF-8                                                                                                		req.setCharacterEncoding("UTF-8");                                                                                   		res.setContentType("text/html;charset=UTF-8");                                                                       		                                                                                                                     		PrintWriter out = res.getWriter();                                                                                   		try {                                                                                                                			// WISEGRID_DATA Param WiseGridG                                                                                 			String rawData = req.getParameter("WISEGRID_DATA");                                                              			                                                                                                                 			gdReq = OperateGridData.parse(rawData);                                                                                                                                                                                                       			String mode = gdReq.getParam("mode");                                                                            			System.out.println("Test :: mode = " + mode);                                                                                                                                                                                                 			if (mode.equals("search")) //                                                                                    				gdRes = doQuery(gdReq);                                                                                      			else if (mode.equals("search2")) //                                                                               				gdRes = doQuery2(gdReq);                                                                                     			else if (mode.equals("search3")) //                                                                               				gdRes = doQuery3(gdReq);			else if (mode.equals("search4")) //                                                                               				gdRes = doQuery4(gdReq);			else if (mode.equals("search5")) //                                                                               				gdRes = doQuery5(gdReq);			else if (mode.equals("search6")) //                                                                               				gdRes = doQuery6(gdReq);			else if (mode.equals("search7")) //                                                                               				gdRes = doQuery7(gdReq);			else if (mode.equals("save")) //                                                                               				gdRes = doSave(gdReq);			else if (mode.equals("save2")) //                                                                               				gdRes = doSave2(gdReq);			else if (mode.equals("delete")) //                                                                               				gdRes = doDelete(gdReq);			else if (mode.equals("doIf")) //                                                                               				gdRes = doIf(gdReq);							} catch (Exception e) {                                                                                              			gdRes = new GridData();                                                                                          			gdRes.setMessage("Error: " + e.getMessage());                                                                    			gdRes.setStatus("false");                                                                                        			e.printStackTrace();                                                                                             		} finally {                                                                                                          			try {                                                                                                            				//                                                                                                           				OperateGridData.write(gdRes, out);                                                                           			} catch (Exception e) {                                                                                          				e.printStackTrace();                                                                                         			}                                                                                                                		}                                                                                                                    	}                                                                                                                        		// DW 1 조회  쿼리	public GridData doQuery(GridData gdReq) throws Exception {                                                               		                                                                                                                     		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_type	= gdReq.getParam("item_type");                                                            			String version		= gdReq.getParam("version"); 			String sales_cat02		= gdReq.getParam("sales_cat02");			String sell_stop_gubn	= gdReq.getParam("sell_stop_gubn");						System.out.println("hggggggg :" + sell_stop_gubn);						String paramKey   ="version!%!item_type!%!sales_cat02!%!sell_stop_gubn";                                                                      			String paramCode  = version+"!%!"+item_type+"!%!"+sales_cat02+"!%!"+sell_stop_gubn;                                                                                                                                                                                                			String query_id   = "op_02010_Long_Term_Planning_list_Hawa_dw1";                                                                                                                             			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			/*선택구분 리스트를 추출하여 콤보리스트 생성 */			String query_id2 = "sel_dmd_list"; 			System.out.println("getSelQeury : " + query_id2);			ArrayList<ArrayList<String>> selDmdList = new CommonUtil().getSelQeury("", "", query_id2);						int arrIdx = selDmdList.size();						String[] selDmdIdList = new String[arrIdx];			String[] selDmdNameList = new String[arrIdx];						System.out.println("출고 사업장 콤보리스트 생성");			for ( int i = 0 ; i < arrIdx ; i++ ){				selDmdIdList[i] = selDmdList.get(i).get(0);   //선택구분 ID 콤보리스트 생성				selDmdNameList[i] = selDmdList.get(i).get(1); // 선택구분 이름 콤보리스트 생성			}						System.out.println("출고 사업장 컬럼에 콤보리스트 set");			gdRes.getHeader("SEL_DMD").setComboValues(selDmdNameList, selDmdIdList );		//선택구분   콤보리스트 출고 사업장 컬럼에 set															for (int i = 0; i < rowCount; i++) {                                                                             				gdRes.getHeader("CRUD"			).addValue( "", "");				gdRes.getHeader("SELECTED"		).addValue("0", "");     				gdRes.getHeader("ITEM_ID"		).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("ITEM_NAME" 	).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("TERM_VAL" 		).addValue(qResult.get(i).get(2  ),"");                                     				gdRes.getHeader("LEAD_TIME" 	).addValue(qResult.get(i).get(3  ),"");				gdRes.getHeader("BASE_UOM" 		).addValue(qResult.get(i).get(4  ),"");				gdRes.getHeader("BASE_STOCK" 	).addValue(qResult.get(i).get(5  ),"");                                     				gdRes.getHeader("PROG_STOCK" 	).addValue(qResult.get(i).get(6  ),"");                                     				gdRes.getHeader("TOT_STOCK" 	).addValue(qResult.get(i).get(7  ),"");                                     				//gdRes.getHeader("SEL_DMD" 		).addValue(qResult.get(i).get(7  ),"");				gdRes.getHeader("SEL_DMD" 		).addSelectedHiddenValue(qResult.get(i).get(8));//출고사업장				gdRes.getHeader("STD_STOCK" 	).addValue(qResult.get(i).get(9  ),"");                                     				gdRes.getHeader("SAFETY_STOCK" 	).addValue(qResult.get(i).get(10 ),"");                                     				gdRes.getHeader("SAFETY_FACTOR" ).addValue(qResult.get(i).get(11 ),"");                                     				gdRes.getHeader("AVG_QTY" 		).addValue(qResult.get(i).get(12 ),"");                                     				gdRes.getHeader("STD_DEV" 		).addValue(qResult.get(i).get(13 ),"");                                     				gdRes.getHeader("SALES_MEAN_3MONTH" 	).addValue(qResult.get(i).get(14 ),"");                                     				gdRes.getHeader("LAST_YEAR" 	).addValue(qResult.get(i).get(15 ),"");                                     				gdRes.getHeader("USE_CUM_MONTH" ).addValue(qResult.get(i).get(16 ),"");                                     				gdRes.getHeader("MIN_LOT_SIZE" 	).addValue(qResult.get(i).get(17 ),"");                                     				gdRes.getHeader("PR_DATE_NO" 	).addValue(qResult.get(i).get(18 ),"");                                     				gdRes.getHeader("PR_QTY" 		).addValue(qResult.get(i).get(19 ),"");                                     				gdRes.getHeader("ENTR_DATE" 	).addValue(qResult.get(i).get(20 ),""); 				gdRes.getHeader("CONTAINER_BOX" 	).addValue(qResult.get(i).get(21 ),"");				gdRes.getHeader("EDIT_FLAG" 	).addValue(qResult.get(i).get(22 ),"");                                     				gdRes.getHeader("IF_FLAG" 		).addValue(qResult.get(i).get(23 ),"");				gdRes.getHeader("PR_NO"			).addValue(qResult.get(i).get(24  ),"");                                      				gdRes.getHeader("IF_MSGS"		).addValue(qResult.get(i).get(25  ),"");                                     											}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}                                                                                                                        	// DW 2 조회  쿼리	public GridData doQuery2(GridData gdReq) throws Exception {                                                               		                                                                                                                     		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                    						try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			                                                                                                                 			String paramKey   ="item_id";                                                                      			String paramCode  = item_id;                                                                                                                                                                                                			String query_id   = "op_02010_Long_Term_Planning_list_dw2";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search2");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {                                                                             				gdRes.getHeader("ITEM_ID"	).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("ITEM_NAME" ).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("PR_NO"		).addValue(qResult.get(i).get(2  ),"");  				gdRes.getHeader("PR_NO_2"	).addValue(qResult.get(i).get(2  ),""); 				gdRes.getHeader("PR_REL"	).addValue(qResult.get(i).get(3  ),"");                                      				gdRes.getHeader("PR_QTY"	).addValue(qResult.get(i).get(4  ),"");                                      				gdRes.getHeader("PO_NO"		).addValue(qResult.get(i).get(5  ),"");				gdRes.getHeader("PO_NO_2"	).addValue(qResult.get(i).get(5  ),"");				gdRes.getHeader("PO_SEQ"	).addValue(qResult.get(i).get(6  ),"");                                      				gdRes.getHeader("PO_DATE"	).addValue(qResult.get(i).get(7  ),"");                                      				gdRes.getHeader("PO_QTY"	).addValue(qResult.get(i).get(8  ),"");                                      				gdRes.getHeader("CREDIT"	).addValue(qResult.get(i).get(9  ),"");								gdRes.getHeader("BL_NO"		).addValue(qResult.get(i).get(10  ),"");				gdRes.getHeader("BL_NO_2"	).addValue(qResult.get(i).get(10  ),"");				gdRes.getHeader("UNSHIP_QTY").addValue(qResult.get(i).get(11  ),"");                                      				gdRes.getHeader("SHIP_QTY"	).addValue(qResult.get(i).get(12  ),"");                                      				gdRes.getHeader("HBL_NO"	).addValue(qResult.get(i).get(13  ),"");                                      				gdRes.getHeader("PORT"		).addValue(qResult.get(i).get(14  ),"");                                      				gdRes.getHeader("TONG"		).addValue(qResult.get(i).get(15  ),"");				gdRes.getHeader("IPGO_REQ"  ).addValue(qResult.get(i).get(16  ),"");								gdRes.getHeader("IPGO"		).addValue(qResult.get(i).get(17  ),"");				gdRes.getHeader("DATE_FLAG"	).addValue(qResult.get(i).get(18  ),""); 				gdRes.getHeader("STATUS"	).addValue(qResult.get(i).get(19  ),"");			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search2");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}                				//하단 그리드 WD3 조회 쿼리	public GridData doQuery3(GridData gdReq) throws Exception {                                                                       		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                    		System.out.println("search3() start!!!");				try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			String version	= gdReq.getParam("version");                                                            			String sel_dmd	= gdReq.getParam("sel_dmd");                                                            			String work_date	= gdReq.getParam("work_date");                                                            			                                                                                                                 			String paramKey   ="version!%!item_id!%!sel_dmd!%!work_date";                                                                      			String paramCode  = version+"!%!"+item_id+"!%!"+sel_dmd+"!%!"+work_date;                                                                                                                                                                                               			String query_id   = "op_02010_Long_Term_Planning_list_Hawa_dw3";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search3");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			System.out.println(rowCount);						for (int i = 0; i < rowCount; i++) {         								gdRes.getHeader("ITEM_ID"	).addValue(qResult.get(i).get(0  ),"");				gdRes.getHeader("ITEM_NAME" ).addValue(qResult.get(i).get(1  ),"");				gdRes.getHeader("SEL_GUBN"	).addValue(qResult.get(i).get(2  ),"");				//gdRes.getHeader("SELECTED"	).addValue("0", "");                    				gdRes.getHeader("SEL_NAME"	).addValue(qResult.get(i).get(3  ),"");				gdRes.getHeader("MON_P15"	).addValue(qResult.get(i).get(4  ),"");				gdRes.getHeader("MON_P14"	).addValue(qResult.get(i).get(5  ),"");				gdRes.getHeader("MON_P13"	).addValue(qResult.get(i).get(6  ),"");				gdRes.getHeader("MON_P12"	).addValue(qResult.get(i).get(7  ),"");				gdRes.getHeader("MON_P11"	).addValue(qResult.get(i).get(8  ),"");				gdRes.getHeader("MON_P10"	).addValue(qResult.get(i).get(9  ),"");				gdRes.getHeader("MON_P09"	).addValue(qResult.get(i).get(10 ),"");				gdRes.getHeader("MON_P08"	).addValue(qResult.get(i).get(11 ),"");				gdRes.getHeader("MON_P07"	).addValue(qResult.get(i).get(12 ),"");				gdRes.getHeader("MON_P06"	).addValue(qResult.get(i).get(13 ),"");				gdRes.getHeader("MON_P05"	).addValue(qResult.get(i).get(14 ),"");				gdRes.getHeader("MON_P04"	).addValue(qResult.get(i).get(15 ),"");				gdRes.getHeader("MON_P03"	).addValue(qResult.get(i).get(16 ),"");				gdRes.getHeader("MON_P02"	).addValue(qResult.get(i).get(17 ),"");				gdRes.getHeader("MON_P01"	).addValue(qResult.get(i).get(18 ),"");				gdRes.getHeader("MON_M00"	).addValue(qResult.get(i).get(19 ),"");				gdRes.getHeader("MON_M01"	).addValue(qResult.get(i).get(20 ),"");				gdRes.getHeader("MON_M02"	).addValue(qResult.get(i).get(21 ),"");				gdRes.getHeader("MON_M03"	).addValue(qResult.get(i).get(22 ),"");				gdRes.getHeader("MON_M04"	).addValue(qResult.get(i).get(23 ),"");				gdRes.getHeader("MON_M05"	).addValue(qResult.get(i).get(24 ),"");				gdRes.getHeader("MON_M06"	).addValue(qResult.get(i).get(25 ),"");				gdRes.getHeader("TP_FLAG"	).addValue("0", "");			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search3");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}     	// DW 4 조회  쿼리	public GridData doQuery4(GridData gdReq) throws Exception {                                                               		                                                                                                                     		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			                                                                                                                 			String paramKey   ="item_id";                                                                      			String paramCode  = item_id;                                                                                                                                                                                                			String query_id   = "op_02010_Long_Term_Planning_list_dw4";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search4");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {                                                                             				gdRes.getHeader("ITEM_ID"	).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("ITEM_NAME" ).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("MM_0_QTY"	).addValue(qResult.get(i).get(2  ),"");                                      				gdRes.getHeader("MM_1_QTY"	).addValue(qResult.get(i).get(3  ),"");                                      				gdRes.getHeader("MM_2_QTY"	).addValue(qResult.get(i).get(4  ),"");                                      				gdRes.getHeader("MM_3_QTY"	).addValue(qResult.get(i).get(5  ),"");                                      				gdRes.getHeader("MM_4_QTY"	).addValue(qResult.get(i).get(6  ),"");                                      				gdRes.getHeader("MM_5_QTY"	).addValue(qResult.get(i).get(7  ),"");                                      				gdRes.getHeader("MM_6_QTY"	).addValue(qResult.get(i).get(8  ),"");                                      				gdRes.getHeader("MM_7_QTY"	).addValue(qResult.get(i).get(9  ),"");                                      				gdRes.getHeader("MM_8_QTY"	).addValue(qResult.get(i).get(10 ),"");                                      				gdRes.getHeader("MM_9_QTY"	).addValue(qResult.get(i).get(11 ),"");                                      			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search4");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}                      		// DW 5 조회  쿼리	public GridData doQuery5(GridData gdReq) throws Exception {                                                                       		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			String work_date	= gdReq.getParam("work_date");                                                            						String paramKey   ="item_id!%!work_date";                                                                      			String paramCode  = item_id+"!%!"+work_date;                                                                                                                                                                                             			String query_id   = "op_02010_Long_Term_Planning_list_Hawa_dw5";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search5");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {								gdRes.getHeader("CUST_TYPE_CODE"	).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("CUST_TYPE" 		).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("NOW_SEL_BOX"		).addValue(qResult.get(i).get(2  ),"");                                      				gdRes.getHeader("NOW_GOAE_BOX"		).addValue(qResult.get(i).get(3  ),"");                                      				gdRes.getHeader("PRE_SEL_BOX"		).addValue(qResult.get(i).get(4  ),"");                                      				gdRes.getHeader("PRE_GOAE_BOX"		).addValue(qResult.get(i).get(5  ),"");                                      			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search5");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}             	// DW 6 조회  쿼리	public GridData doQuery6(GridData gdReq) throws Exception {                                                                       		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			String work_date	= gdReq.getParam("work_date");                                                            						String paramKey   ="item_id!%!work_date";                                                                      			String paramCode  = item_id+"!%!"+work_date;                                                                                                                                                                                                			String query_id   = "op_02010_Long_Term_Planning_list_Hawa_dw6";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search6");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {								gdRes.getHeader("ITEM_ID"	).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("ITEM_NAME" ).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("G_ZONE"	).addValue(qResult.get(i).get(2  ),"");                                      				gdRes.getHeader("Y_ZONE"	).addValue(qResult.get(i).get(3  ),"");                                      				gdRes.getHeader("R_ZONE"	).addValue(qResult.get(i).get(4  ),"");                                      			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search6");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}        		// DW 7 조회  쿼리	public GridData doQuery7(GridData gdReq) throws Exception {                                                                       		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String item_id	= gdReq.getParam("item_id");                                                            			String work_date	= gdReq.getParam("work_date");                                                            						String paramKey   ="item_id!%!work_date";                                                                      			String paramCode  = item_id+"!%!"+work_date;                                                                                                                                                                                                      			String query_id   = "op_02010_Long_Term_Planning_list_Hawa_dw7";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search7");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {								gdRes.getHeader("MONTH"		).addValue(qResult.get(i).get(0  ),"");                                      				gdRes.getHeader("GOAL_YM0"	).addValue(qResult.get(i).get(1  ),"");                                     				gdRes.getHeader("SELL_YM0"	).addValue(qResult.get(i).get(2  ),"");                                      				gdRes.getHeader("GOAL_YM1" 	).addValue(qResult.get(i).get(3  ),"");                                     				gdRes.getHeader("SELL_YM1"	).addValue(qResult.get(i).get(4  ),"");                                      				gdRes.getHeader("GOAL_YM2"	).addValue(qResult.get(i).get(5  ),"");                                      				gdRes.getHeader("SELL_YM2"	).addValue(qResult.get(i).get(6  ),"");                                      				gdRes.getHeader("GOAL_YM3"	).addValue(qResult.get(i).get(7  ),"");                                      				gdRes.getHeader("SELL_YM4"	).addValue(qResult.get(i).get(8  ),"");                                                                           			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search7");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}	public GridData doSave(GridData gdReq) throws Exception {		System.out.println("doSave() start!!!");		conn = databaseUtility.getConnection("t3sinc"); // DB Connection		stmt = conn.createStatement(); // statement 객체 생성		GridData gdRes = new GridData(); // WiseGrid 객체생성		int rowCount = 0; // CRUD 컬럼 row 수				System.out.println("Total Row Count : " + gdReq.getHeader("ITEM_ID").getRowCount());		try {			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.			rowCount = gdReq.getHeader("CRUD").getRowCount();						if(rowCount == 0) {				gdRes.addParam("mode", "save");				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");				gdRes.setStatus("true");				return gdRes;			}						String user_id		= gdReq.getParam("user_id");			String version		= gdReq.getParam("version");			String loc_id		= gdReq.getParam("loc_id");			System.out.println("Row Count : " + rowCount);			String sql;			String sql2;									//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql  = "	MERGE INTO APS_PR_PLAN AP  /*+ bypass_ujvc*/ 																	\n";			sql += "	USING( 																											\n";				sql2  = "	MERGE INTO ITEM_MST IM  /*+ bypass_ujvc*/ 																		\n";			sql2 += "	USING( 																											\n";						boolean flag = false;						// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {								if( flag){						sql  += "UNION ALL \n";					//sql2 += "union all \n";					//sql3 += "union all \n";				}				flag = true;								//파라미터를 변수에 적용!!									 								//-------------------------------------------------------------------------------------------------------------------				sql +="			SELECT	   '" +	version															+ "'      AS VERSION, 		\n"; 				sql +="					   '" + gdReq.getHeader("ITEM_ID"		).getValue(i)   				+ "'   	  AS ITEM_ID,   	\n";				sql +="					   '" + gdReq.getHeader("STD_STOCK"		).getValue(i)   				+ "'   	  AS STD_STOCK,  	\n";				sql +="					   '" + gdReq.getHeader("PR_QTY"		).getValue(i)   				+ "'   	  AS PR_QTY, 		\n";				sql +="					   '" + gdReq.getHeader("ENTR_DATE"		).getValue(i).replace("-", "")  + "'   	  AS ENTR_DATE, 	\n";				sql +="					   '" + user_id  									  					+ "' 	  AS MADE_BY,		\n";				sql +="					   '" + loc_id  									  					+ "' 	  AS LOC_ID			\n";				sql +="			from   DUAL 																			   					\n";						              // --------------------------------------------------------------------------------------------------------------------						}				//-----------------------------Merge Into 1-----------------------------	-----------------------------------------------------			sql += ") AP1 														   		\n";			sql += "ON (AP.VERSION    		= AP1.VERSION    						   	\n";			sql += "AND AP.ITEM_ID     		= AP1.ITEM_ID)          				   	\n";						sql += "when matched then update set            					   		\n";			sql += "     AP.STD_STOCK   	= AP1.STD_STOCK,      						\n";  			sql += "     AP.PR_QTY  		= AP1.PR_QTY,  					   			\n";			sql += "     AP.ENTR_DATE		= AP1.ENTR_DATE,	      					\n";			sql += "     AP.MADE_BY     	= AP1.MADE_BY,	      					   	\n";			sql += "     AP.MADE_DTTM     	= SYSDATE,	      					   		\n";			sql += "     AP.LOC_ID     		= AP1.LOC_ID,	      					   	\n";			sql += "     AP.PR_QTY_UOM    	= 'BOX'	      					   			\n";		        //---------------------------------------------------------------------------------------------------------------------------						System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println(sql);			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println("executeQuery 실행!!!");			rs = databaseUtility.executeQuery(stmt, sql);			System.out.println("executeQuery 종료!!!");					flag = false;						// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {									if( flag){						sql2 += "UNION	ALL \n"; 					}					flag = true;								//-------------------------------------------------------------------------------------------------------------------					sql2 +="			SELECT	   '" + gdReq.getHeader("ITEM_ID"		).getValue(i)   		+ "'   	  AS ITEM_ID,   	\n";									 					sql2 +="					   '" + gdReq.getHeader("SAFETY_STOCK"	).getValue(i)   		+ "'   	  AS MINSS			\n";									sql2 +="			from   DUAL 																		   				\n";							               //--------------------------------------------------------------------------------------------------------------------			}								//-----------------------------Merge Into 2-----------------------------	-----------------------------------------------------			sql2 += ") IM1 														   		\n";			sql2 += "ON (IM.ITEM_ID    		= IM1.ITEM_ID)    						   	\n";			sql2 += "when matched then update set            					   		\n";			sql2 += "IM.MINSS    = IM1.MINSS      										\n";  				        //---------------------------------------------------------------------------------------------------------------------------									System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println(sql2);			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");						/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////						System.out.println("executeQuery 실행!!!");			rs = databaseUtility.executeQuery(stmt, sql2);			System.out.println("executeQuery 종료!!!");						/*			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다			 */			gdRes.addParam("mode", "save");			gdRes.setMessage("성공적으로 작업하였습니다.");			gdRes.setStatus("true");					}catch (Exception e) {			throw e;		}finally {            databaseUtility.close(conn, stmt, rs);           }        System.out.println("doSave() end!!!");		return gdRes;	}					public GridData doSave2(GridData gdReq) throws Exception {		System.out.println("doSave2() start!!!");		conn = databaseUtility.getConnection("t3sinc"); // DB Connection		stmt = conn.createStatement(); // statement 객체 생성		GridData gdRes = new GridData(); // WiseGrid 객체생성		int rowCount = 0; // CRUD 컬럼 row 수				//System.out.println("Total Row Count : " + gdReq.getHeader("SEL_GUBN").getRowCount());		try {			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.			rowCount = gdReq.getHeader("SEL_GUBN").getRowCount();						if(rowCount == 0) {				gdRes.addParam("mode", "save2");				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");				gdRes.setStatus("true");				return gdRes;			}						String user_id		= gdReq.getParam("user_id");			String version		= gdReq.getParam("version");			String dc_id		= gdReq.getParam("dc_id");			System.out.println("Row Count : " + rowCount);			String sql;									//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql  = "	MERGE INTO HAWA_STOCK_SUUPORT_PLAN HP  /*+ bypass_ujvc*/ 														\n";			sql += "	USING( 																											\n";							boolean flag = false;						// 데이터 셋팅 발주량 Row 1번만 돈다			for (int i = 0; i < 1; i++) {								if( flag){						sql  += "UNION ALL \n";								}				flag = true;								//파라미터를 변수에 적용!!									//-------------------------------------------------------------------------------------------------------------------				sql +="			SELECT	   '" +	version															+ "'      AS CNFM_DATE, 	\n";				sql +="					   '" +	dc_id															+ "'      AS DC_ID,		 	\n";				sql +="					   '" + gdReq.getHeader("ITEM_ID"		).getValue(0)   				+ "'   	  AS ITEM_ID,   	\n";				sql +="					   '" + gdReq.getHeader("MON_M01"		).getValue(6)   				+ "'   	  AS M1_QTY,  		\n";				sql +="					   '" + gdReq.getHeader("MON_M02"		).getValue(6)   				+ "'   	  AS M2_QTY,  		\n";				sql +="					   '" + gdReq.getHeader("MON_M03"		).getValue(6)   				+ "'   	  AS M3_QTY,  		\n";				sql +="					   '" + gdReq.getHeader("MON_M04"		).getValue(6)   				+ "'   	  AS M4_QTY,  		\n";				sql +="					   '" + gdReq.getHeader("MON_M05"		).getValue(6)   				+ "'   	  AS M5_QTY,  		\n";				sql +="					   '" + gdReq.getHeader("MON_M06"		).getValue(6)   				+ "'   	  AS M6_QTY,  		\n";				sql +="					   '" + user_id  									  					+ "' 	  AS MADE_BY		\n";				sql +="			from   DUAL 																			   				\n";						              // --------------------------------------------------------------------------------------------------------------------						}				//-----------------------------Merge Into 1-----------------------------	-----------------------------------------------------			sql += ") HP1 														   		\n";			sql += "ON (HP.CNFM_DATE    	= HP1.CNFM_DATE    							\n";			sql += "AND HP.ITEM_ID     		= HP1.ITEM_ID          				   		\n";			sql += "AND HP.DC_ID     		= HP1.DC_ID)          				   		\n";			sql += "when matched then update set            					   		\n";						sql += "     HP.M1_QTY	 	  	= HP1.M1_QTY,      							\n"; 			sql += "     HP.M2_QTY	 	  	= HP1.M2_QTY,      							\n"; 			sql += "     HP.M3_QTY	 	  	= HP1.M3_QTY,      							\n"; 			sql += "     HP.M4_QTY	 	  	= HP1.M4_QTY,      							\n"; 			sql += "     HP.M5_QTY	 	  	= HP1.M5_QTY,      							\n"; 			sql += "     HP.M6_QTY	 	  	= HP1.M6_QTY,      							\n"; 			sql += "     HP.MADE_BY     	= HP1.MADE_BY,	      					   	\n";			sql += "     HP.MADE_DTTM     	= SYSDATE	      					   		\n";			sql += "when not matched then insert(CNFM_DATE, ITEM_ID, DC_ID, M1_QTY, M2_QTY, M3_QTY, M4_QTY, M5_QTY, M6_QTY, MADE_DTTM,MADE_BY) 					 \n";			sql += "values  (HP1.CNFM_DATE,HP1.ITEM_ID, HP1.DC_ID, HP1.M1_QTY, HP1.M2_QTY, HP1.M3_QTY, HP1.M4_QTY, HP1.M5_QTY, HP1.M6_QTY, SYSDATE, HP1.MADE_BY) \n";		        //---------------------------------------------------------------------------------------------------------------------------						System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println(sql);			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println("executeQuery 실행!!!");			rs = databaseUtility.executeQuery(stmt, sql);			System.out.println("executeQuery 종료!!!");						/*			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다			 */			gdRes.addParam("mode", "save2");			gdRes.setMessage("성공적으로 작업하였습니다.");			gdRes.setStatus("true");					}catch (Exception e) {			throw e;		}finally {            databaseUtility.close(conn, stmt, rs);           }        System.out.println("doSave2() end!!!");		return gdRes;	}		public GridData doDelete(GridData gdReq) throws Exception {		System.out.println("doDelete() start!!!");		conn = databaseUtility.getConnection("t3sinc"); // DB Connection		stmt = conn.createStatement(); // statement 객체 생성		GridData gdRes = new GridData(); // WiseGrid 객체생성		int rowCount = 0; // CRUD 컬럼 row 수				System.out.println("Total Row Count : " + gdReq.getHeader("ITEM_ID").getRowCount());		try {			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.			rowCount = gdReq.getHeader("CRUD").getRowCount();						if(rowCount == 0) {				gdRes.addParam("mode", "Delete");				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");				gdRes.setStatus("true");				return gdRes;			}			System.out.println("CRUD Row Count : " + rowCount);			//String user_id = gdReq.getParam("user_id");			String sql, inner_sql;						//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql += "	( 																												\n";			sql += "	SELECT																											\n";			sql += "			T1.ITEM_ID, T1.VERSION, T1.SAFETY_FACTOR,												\n";			sql += "			T1.PR_DATE_NO, T1.PR_QTY, T1.ENTR_DATE,	T1.MADE_DTTM, T1.EDIT_FLAG,						\n";			sql += "			T2.NEW_SAFETY_FACTOR,	T2.NEW_PR_DATE_NO,												\n";			sql += "			T2.NEW_PR_QTY,	T2.NEW_ENTR_DATE, T2.NEW_EDIT_FLAG										\n";			sql += "	FROM	APS_PR_PLAN	T1,                                                                                        	\n";			sql += "			(                                                                                                      	\n";						boolean flag = false;						// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				String version	= gdReq.getParam("version");				System.out.println("crud ="+crud);				//System.out.println("SEL_DMD : " + gdReq.getHeader("SEL_DMD").getHiddenValue(i));								if(crud.equals("U")) {					 					if( flag){						sql += "UNION	ALL \n"; 					}					flag = true;															//파라미터를 변수에 적용!!  					inner_sql  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";					inner_sql += "				'" + version										+ "'	AS VERSION,     		\n";					inner_sql += "				0														AS NEW_SAFETY_FACTOR,   \n";					inner_sql += "				0														AS NEW_PR_DATE_NO,  	\n";					inner_sql += "				0														AS NEW_PR_QTY,			\n";					inner_sql += "				' '														AS NEW_ENTR_DATE,   \n";					inner_sql += "				' '														AS NEW_EDIT_FLAG		\n";					inner_sql += "	FROM	DUAL			                                                  													\n";										sql += inner_sql;										if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.						sql += "UNION	ALL \n" + inner_sql;					}				}												}//for문 끝.						sql += "			)			T2                                                                                      \n";			sql += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";			sql += "	AND		T1.VERSION	= T2.VERSION                                                                            \n";			sql += "	)                                                                                                        	\n";			sql += "	SET		PR_DATE_NO = NEW_PR_DATE_NO,	PR_QTY	= NEW_PR_QTY,												\n";			//sql += "			STD_STOCK = NEW_STD_STOCK,		SAFETY_STOCK	= NEW_SAFETY_STOCK,					                \n";						sql += "			ENTR_DATE = NEW_ENTR_DATE,		SAFETY_FACTOR	= NEW_SAFETY_FACTOR,								\n";			sql += "			EDIT_FLAG = NEW_EDIT_FLAG,																			\n";			sql += "			MADE_DTTM	= SYSDATE															                  	\n";			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println(sql);			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");						System.out.println("executeQuery 실행!!!");						rs = databaseUtility.executeQuery(stmt, sql);						System.out.println("executeQuery 종료!!!");						/*			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다			 */			gdRes.addParam("mode", "Delete");			gdRes.setMessage("성공적으로 작업하였습니다.");			gdRes.setStatus("true");					}catch (Exception e) {			throw e;		}finally {            databaseUtility.close(conn, stmt, rs);           }        System.out.println("doDelete() end!!!");		return gdRes;	}					public GridData doIf(GridData gdReq) throws Exception {		System.out.println("doIf() start!!!");		conn = databaseUtility.getConnection("t3sinc"); // DB Connection		stmt = conn.createStatement(); // statement 객체 생성		GridData gdRes = new GridData(); // WiseGrid 객체생성		int rowCount = 0; // CRUD 컬럼 row 수				System.out.println("Total Row Count : " + gdReq.getHeader("ITEM_ID").getRowCount());		try {			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.			rowCount = gdReq.getHeader("CRUD").getRowCount();						if(rowCount == 0) {				gdRes.addParam("mode", "doIf");				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");				gdRes.setStatus("true");				return gdRes;			}			System.out.println("CRUD Row Count : " + rowCount);			//String user_id = gdReq.getParam("user_id");			String sql, inner_sql;						//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql += "	( 																												\n";			sql += "	SELECT																											\n";			sql += "			T1.ITEM_ID, T1.VERSION,  T1.IF_FLAG, T2.NEW_IF_FLAG, T1.EDIT_FLAG, T2.NEW_EDIT_FLAG						\n";			sql += "	FROM	APS_PR_PLAN	T1,                                                                                        	\n";			sql += "			(                                                                                                      	\n";						boolean flag = false;						// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				String version	= gdReq.getParam("version");				//String loc_id	= gdReq.getParam("loc_id");				System.out.println("crud ="+crud);				//System.out.println("SEL_DMD : " + gdReq.getHeader("SEL_DMD").getHiddenValue(i));								if(crud.equals("U")) {					 					if( flag){						sql += "UNION	ALL \n"; 					}					flag = true;															//파라미터를 변수에 적용!!  					inner_sql  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";					inner_sql += "				'" + version										+ "'	AS VERSION,     		\n";					inner_sql += "				'I'															AS NEW_IF_FLAG,			\n";					inner_sql += "				'Y'															AS NEW_EDIT_FLAG		\n";					inner_sql += "	FROM	DUAL			                                                  													\n";										sql += inner_sql;										if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.						sql += "UNION	ALL \n" + inner_sql;					}				}												}//for문 끝.						sql += "			)			T2                                                                                      \n";			sql += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";			sql += "	AND		T1.VERSION	= T2.VERSION                                                                            \n";			sql += "	)                                                                                                        	\n";			sql += "	SET		IF_FLAG = NEW_IF_FLAG, EDIT_FLAG = NEW_EDIT_FLAG														\n";			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");			System.out.println(sql);			System.out.println("-----------------------------------------------QUERY-----------------------------------------------");						System.out.println("executeQuery 실행!!!");						rs = databaseUtility.executeQuery(stmt, sql);						System.out.println("executeQuery 종료!!!");						/*			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다			 */			gdRes.addParam("mode", "doIf");			gdRes.setMessage("성공적으로 작업하였습니다.");			gdRes.setStatus("true");					}catch (Exception e) {			throw e;		}finally {            databaseUtility.close(conn, stmt, rs);           }        System.out.println("doIf() end!!!");		return gdRes;	}				}                                                                                                                  