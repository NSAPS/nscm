package com.wisegrid.admin;                                                                                                                                                                                                                                                                                                                                                            import java.io.IOException;                                                                                                  import java.io.PrintWriter;                                                                                                  import java.sql.SQLException;                                                                                                import java.util.ArrayList;                                                                                                                                                                                                                               import javax.servlet.ServletException;                                                                                       import javax.servlet.http.HttpServlet;                                                                                       import javax.servlet.http.HttpServletRequest;                                                                                import javax.servlet.http.HttpServletResponse;                                                                                                                                                                                                            import com.zionex.t3sinc.common.CommonUtil;                                                                                  import xlib.cmc.GridData;                                                                                                    import xlib.cmc.OperateGridData;                                                                                                                                                                                                                                                                                                                                                       import java.sql.Connection;                                                                                                  import java.sql.ResultSet;                                                                                                   import java.sql.Statement;                                                                                                   import java.util.HashMap;                                                                                                    import java.util.Iterator;                                                                                                   import java.util.LinkedList;                                                                                                 import java.util.Map;                                                                                                                                                                                                                                     import com.zionex.t3sinc.util.db.SincDatabaseUtility;                                                                        /**                                                                                                                           *                                                                                                                            * @author iCOMPIA CORP.                                                                                                      */                                                                                                                          public class sc_17010_Production_base_list_new2 extends HttpServlet {                                                                                                                                                                                          	private static final long serialVersionUID = -419201700278107216L;                                                       	                                                                                                                         	Connection 	conn 	= null;                                                                                              	Statement 	stmt	= null;                                                                                              	ResultSet	rs		= null;	                                                                                             	ResultSet	rs2		= null;	                                                                                             	ResultSet	rs3		= null;	 	ResultSet	rs4		= null;	String 		sql 	= null;                                                                                              	//Map sessionMap 	= new HashMap();                                                                                     	                                                                                                                         	SincDatabaseUtility databaseUtility = new SincDatabaseUtility();	                                                                                                                                                                                  	public void doPost(HttpServletRequest req, HttpServletResponse res) throws IOException, ServletException {               		GridData gdReq = null;                                                                                               		GridData gdRes = null;                                                                                                                                                                                                                                    System.out.println("START...");                                                                                                                                                                                                                   		// Encode Type; UTF-8                                                                                                		req.setCharacterEncoding("UTF-8");                                                                                   		res.setContentType("text/html;charset=UTF-8");                                                                       		                                                                                                                     		PrintWriter out = res.getWriter();                                                                                   		try {                                                                                                                			// WISEGRID_DATA Param WiseGridG                                                                                 			String rawData = req.getParameter("WISEGRID_DATA");                                                              			                                                                                                                 			gdReq = OperateGridData.parse(rawData);                                                                                                                                                                                                       			String mode = gdReq.getParam("mode");                                                                            			System.out.println("Test :: mode = " + mode);                                                                                                                                                                                                 			if (mode.equals("search")) //                                                                                    				gdRes = doQuery(gdReq);                                                                                      			else if (mode.equals("save")) //                                                                               				gdRes = doSave(gdReq);   //doSave   // doSave_dev//			else if (mode.equals("cre_data")) //                                                                               //				gdRes = doCreData(gdReq);													} catch (Exception e) {                                                                                              			gdRes = new GridData();                                                                                          			gdRes.setMessage("Error: " + e.getMessage());                                                                    			gdRes.setStatus("false");                                                                                        			e.printStackTrace();                                                                                             		} finally {                                                                                                          			try {                                                                                                            				//                                                                                                           				OperateGridData.write(gdRes, out);                                                                           			} catch (Exception e) {                                                                                          				e.printStackTrace();                                                                                         			}                                                                                                                		}                                                                                                                    	}                                                                                                                                                                                                                                                       	public GridData doQuery(GridData gdReq) throws Exception {                                                               		                                                                                                                     		GridData gdRes = new GridData();		                                                                             		int rowCount = 0;                                                                                                                                                                                                                                 		try {                                                                                                                			gdRes = OperateGridData.cloneResponseGridData(gdReq);                                                            			                                                                                                                 			String cnfm_date = gdReq.getParam("cnfm_date");      			String chk_sort	 = gdReq.getParam("chk_sort");			                                                                                                                 			String paramKey   ="cnfm_date!%!chk_sort";                                                                      			String paramCode  = cnfm_date+"!%!"+chk_sort;				        System.out.println("cnfm_date="+cnfm_date);                                                                                      			                                                                                                                             			String query_id   = "sc_17010_Production_base_list_new2";                                                                                                                                                                                          			ArrayList<ArrayList<String>> qResult = new CommonUtil().getSelQeury(paramKey, paramCode, query_id);              			                                                                                                                 			rowCount = qResult.size();                                                                                                                                                                                                                    			//                                                                                                               			if (rowCount == 0) {                                                                                             				gdRes.addParam("mode", "search");		                                                                     				gdRes.setMessage("...");                                                                                     				gdRes.setStatus("true");                                                                                     				return gdRes;                                                                                                			}                                                                                                                			                                                                                                                 			for (int i = 0; i < rowCount; i++) {								gdRes.getHeader("CRUD"				).addValue( "", "");				gdRes.getHeader("SALES_CAT03"		).addValue(qResult.get(i).get(0  ),"");				gdRes.getHeader("SALES_CAT_SCM"		).addValue(qResult.get(i).get(1  ),"");				gdRes.getHeader("ITEM_ID"			).addValue(qResult.get(i).get(2  ),"");                                      				gdRes.getHeader("ITEM_NAME"			).addValue(qResult.get(i).get(3  ),""); 				gdRes.getHeader("SALES_MEAN_1WEEK"	).addValue(qResult.get(i).get(4  ),"");				gdRes.getHeader("SALES_MEAN_3WEEK"	).addValue(qResult.get(i).get(5  ),"");				gdRes.getHeader("FRC_QTY"			).addValue(qResult.get(i).get(6  ),"");				gdRes.getHeader("BASE_DAY"			).addValue(qResult.get(i).get(7  ),"");				gdRes.getHeader("SALES_EXPT"		).addValue(qResult.get(i).get(8  ),"");				gdRes.getHeader("BASE_CP_DAY"		).addValue(qResult.get(i).get(9  ),"");                                      				gdRes.getHeader("PRODUCE_TERM"		).addValue(qResult.get(i).get(10  ),"");                                      				gdRes.getHeader("PRE_STOCK_DAY"		).addValue(qResult.get(i).get(11  ),"");    				gdRes.getHeader("TOT_SAFE_DAY"		).addValue(qResult.get(i).get(12  ),"");				gdRes.getHeader("SAFE_STOCK_QTY"	).addValue(qResult.get(i).get(13  ),"");				gdRes.getHeader("EVENT_QTY"			).addValue(qResult.get(i).get(14  ),""); 				gdRes.getHeader("TOT_SUPPLY_QTY"	).addValue(qResult.get(i).get(15  ),"");				gdRes.getHeader("W0_BASE_STOCK"		).addValue(qResult.get(i).get(16  ),""); //금주기초재고				gdRes.getHeader("W0_PROD_QTY"		).addValue(qResult.get(i).get(17  ),"");  //금주생산계획				gdRes.getHeader("W0_SUPPLY_QTY"		).addValue(qResult.get(i).get(18  ),"");				gdRes.getHeader("PROD_DEMAND_QTY"	).addValue(qResult.get(i).get(19  ),"");				gdRes.getHeader("PROD_PLAN_QTY"		).addValue(qResult.get(i).get(20  ),""); //생산계획량				gdRes.getHeader("W1_PROD_PLAN"		).addValue(qResult.get(i).get(21  ),"");				gdRes.getHeader("PROD_PLAN_SUB"		).addValue(qResult.get(i).get(22  ),"");				gdRes.getHeader("PROD_PLAN_QTY2"	).addValue(qResult.get(i).get(23  ),"");				gdRes.getHeader("PROD_PLAN_SAFE_QTY"	).addValue(qResult.get(i).get(24  ),qResult.get(i).get(25));				                                                                                                                             			}                                                                                                                                                                                                                                             			gdRes.addParam("mode", "search");		                                                                         			gdRes.setMessage("");                                                                                            			gdRes.setStatus("true");                                                                                                                                                                                                                      		} catch (Exception e) {                                                                                              			throw e;                                                                                                         		}                                                                                                                    				                                                                                                             		return gdRes;                                                                                                        	}		public GridData doSave(GridData gdReq) throws Exception {		System.out.println("doSave() start!!!");		conn = databaseUtility.getConnection("t3sinc"); // DB Connection		stmt = conn.createStatement(); // statement 객체 생성		GridData gdRes = new GridData(); // WiseGrid 객체생성		int rowCount = 0; // CRUD 컬럼 row 수		int save_rowCount 	= 0; 		int save_rowCount2 	= 0; 		int save_rowCount3 	= 0; 		int save_rowCount4 	= 0; 				System.out.println("Total Row Count : " + gdReq.getHeader("ITEM_ID").getRowCount());		try {			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.			rowCount			= gdReq.getHeader("CRUD").getRowCount();			String cnfm_date 	= gdReq.getParam("cnfm_date");						if(rowCount == 0) {				gdRes.addParam("mode", "Save");				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");				gdRes.setStatus("true");				return gdRes;			}			System.out.println("CRUD Row Count : " + rowCount);			//String user_id = gdReq.getParam("user_id");			String sql, inner_sql, inner_sql1_2 = ""; 			String sql2, inner_sql2, inner_sql2_2 = "";			String sql3, inner_sql3, inner_sql3_2 = "";			String sql4, inner_sql4, inner_sql4_2 = "";						//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql += "	( 																												\n";			sql += "	SELECT																											\n";			sql += "		 T1.ITEM_ID, T1.BASE_DAY, T1.BASE_CP_DAY, T1.PRODUCE_TERM, T1.PRE_STOCK_DAY,								\n";			sql += "		 T2.NEW_BASE_DAY, T2.NEW_BASE_CP_DAY, T2.NEW_PRODUCE_TERM, T2.NEW_PRE_STOCK_DAY								\n";			sql += "	FROM	ITEM_MST	T1,                                                                                        	\n";			sql += "			(                                                                                                      	\n";			boolean flag = false;			// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				System.out.println("crud ="+crud);				if(crud.equals("U")) {					if( flag){						sql += "UNION	ALL \n"; 					}					flag = true;					//파라미터를 변수에 적용!!  					inner_sql  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";					inner_sql += "				'" + gdReq.getHeader("BASE_DAY").getValue(i)		+ "'	AS NEW_BASE_DAY,	   	\n";					inner_sql += "				'" + gdReq.getHeader("BASE_CP_DAY").getValue(i)		+ "'	AS NEW_BASE_CP_DAY,	   	\n";					inner_sql += "				'" + gdReq.getHeader("PRODUCE_TERM").getValue(i)	+ "'	AS NEW_PRODUCE_TERM,   	\n";					inner_sql += "				'" + gdReq.getHeader("PRE_STOCK_DAY").getValue(i)	+ "'	AS NEW_PRE_STOCK_DAY   	\n";					inner_sql += "	FROM	DUAL			                                                  						\n";					sql += inner_sql;					save_rowCount ++;					inner_sql1_2 = inner_sql;				}												}//for문 끝.						if(save_rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.				sql += "	UNION	ALL \n" + inner_sql1_2;			}									sql += "			)			T2                                                                                      \n";			sql += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";			sql += "	)                                                                                                        	\n";			sql += "	SET		BASE_DAY = NEW_BASE_DAY	, BASE_CP_DAY = NEW_BASE_CP_DAY,						                  	\n";			sql += "			PRODUCE_TERM = NEW_PRODUCE_TERM	, PRE_STOCK_DAY = NEW_PRE_STOCK_DAY				                  	\n";						System.out.println("-----------------------------------------------QUERY_1-----------------------------------------------");			System.out.println(sql);			System.out.println("-----------------------------------------------QUERY_1-----------------------------------------------");						//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////			//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql2  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql2 += "	( 																												\n";			sql2 += "	SELECT																											\n";			sql2 += "			T1.ITEM_ID, T1.FRC_QTY, T1.EVENT_QTY, T2.NEW_FRC_QTY, T2.NEW_EVENT_QTY									\n";			sql2 += "	FROM	USER_FORECAST	T1,                                                                                     \n";			sql2 += "			(                                                                                                      	\n";			boolean flag2 = false;			// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				System.out.println("crud ="+crud);				if(crud.equals("U")) {					if( flag2){						sql2 += "UNION	ALL \n"; 					}					flag2 = true;					//파라미터를 변수에 적용!!  					inner_sql2  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";					inner_sql2 += "				'" + gdReq.getHeader("FRC_QTY").getValue(i)			+ "'	AS NEW_FRC_QTY,    		\n";					inner_sql2 += "				'" + gdReq.getHeader("EVENT_QTY").getValue(i)		+ "'	AS NEW_EVENT_QTY    	\n";					inner_sql2 += "	FROM	DUAL			                                                  						\n";										sql2 += inner_sql2;					save_rowCount2 ++;					inner_sql2_2 = inner_sql2;										if(save_rowCount2 == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.						sql2 += "UNION	ALL \n" + inner_sql2_2;					}				}												}//for문 끝.						sql2 += "			)			T2                                                                                      \n";			sql2 += "	WHERE	T1.ITEM_ID		= T2.ITEM_ID                                                                        \n";			sql2 += "	AND		T1.CNFM_DATE	= TO_CHAR(TRUNC(TO_DATE(REPLACE('" + cnfm_date + "','-',''),'YYYYMMDD'),'DY')+8,'YYYYMMDD')	\n";						sql2 += "	)                                                                                                        	\n";			sql2 += "	SET		FRC_QTY = NEW_FRC_QTY, EVENT_QTY = NEW_EVENT_QTY													\n";			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");			System.out.println(sql2);			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");			//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////			//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql3  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql3 += "	( 																												\n";			sql3 += "	SELECT																											\n";			sql3 += "			T1.ITEM_ID, T1.LST_PRODQTY, T2.NEW_LST_PRODQTY															\n";			sql3 += "	FROM	PLANT_ALLOC_ITEM_ADJ	T1,                                                                             \n";			sql3 += "			(                                                                                                      	\n";			boolean flag3 = false;			// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				System.out.println("crud ="+crud);				if(crud.equals("U")) {					if( flag3){						sql3 += "UNION	ALL \n"; 					}					flag3 = true;					//파라미터를 변수에 적용!!  					inner_sql3  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 			+ "'	AS ITEM_ID, 			\n";					inner_sql3 += "				'" + gdReq.getHeader("PROD_PLAN_QTY").getValue(i)		+ "'	AS NEW_LST_PRODQTY    	\n";										inner_sql3 += "	FROM	DUAL			                                                  							\n";										sql3 += inner_sql3;					save_rowCount3 ++;					inner_sql3_2 = inner_sql3;					if(save_rowCount3 == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.						sql3 += "UNION	ALL \n" + inner_sql3_2;					}				}												}//for문 끝.			sql3 += "			)			T2                                                                                      \n";			sql3 += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";			sql3 += "	AND		T1.VERSION	LIKE TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "'),'D')+2,'YYYYMMDD')||'%'                 \n";			sql3 += "	AND		T1.DUE_DATE	= TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "')+7,'D')+6,'YYYY-MM-DD')						\n";			sql3 += "	)                                                                                                        	\n";			sql3 += "	SET		LST_PRODQTY = NEW_LST_PRODQTY													                  	\n";			System.out.println("-----------------------------------------------QUERY_3-----------------------------------------------");			System.out.println(sql3);			System.out.println("-----------------------------------------------QUERY_3-----------------------------------------------");			//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////									//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!				sql4  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";			sql4 += "	( 																												\n";			sql4 += "	SELECT																											\n";			sql4 += "			T1.ITEM_ID, T1.LST_PRODQTY, T2.NEW_LST_PRODQTY															\n";			sql4 += "	FROM	PLANT_ALLOC_ITEM_ADJ	T1,                                                                             \n";			sql4 += "			(                                                                                                      	\n";			boolean flag4 = false;			// 데이터 셋팅			for (int i = 0; i < rowCount; i++) {				System.out.println("어디에서 에러 !! 1 : ");								String crud = gdReq.getHeader("CRUD").getValue(i);				System.out.println("crud ="+crud);				if(crud.equals("U")) {					if( flag4){						sql4 += "UNION	ALL \n"; 					}					flag4 = true;					//파라미터를 변수에 적용!!  					inner_sql4  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 			+ "'	AS ITEM_ID, 			\n";					inner_sql4 += "				'" + gdReq.getHeader("PROD_PLAN_QTY2").getValue(i)		+ "'	AS NEW_LST_PRODQTY    	\n";										inner_sql4 += "	FROM	DUAL			                                                  							\n";										sql4 += inner_sql4;					save_rowCount4 ++;					inner_sql4_2 = inner_sql4;										if(save_rowCount4 == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.						sql4 += "UNION	ALL \n" + inner_sql4_2;					}				}												}//for문 끝.			sql4 += "			)			T2                                                                                      \n";			sql4 += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";			sql4 += "	AND		T1.VERSION	LIKE TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "'),'D')+2,'YYYYMMDD')||'%'                 \n";			sql4 += "	AND		T1.DUE_DATE	= TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "')+14,'D')+6,'YYYY-MM-DD')					\n";			sql4 += "	)                                                                                                        	\n";			sql4 += "	SET		LST_PRODQTY = NEW_LST_PRODQTY													                  	\n";			System.out.println("-----------------------------------------------QUERY_4-----------------------------------------------");			System.out.println(sql4);			System.out.println("-----------------------------------------------QUERY_4-----------------------------------------------");						System.out.println("executeQuery 실행!!!");						rs = databaseUtility.executeQuery(stmt, sql);			rs2 = databaseUtility.executeQuery(stmt, sql2);			rs3 = databaseUtility.executeQuery(stmt, sql3);				rs4 = databaseUtility.executeQuery(stmt, sql4);				System.out.println("executeQuery 종료!!!");						/*			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다			 */			gdRes.addParam("mode", "save");			gdRes.setMessage("성공적으로 작업하였습니다.");			gdRes.setStatus("true");					}catch (Exception e) {			throw e;		}finally {            databaseUtility.close(conn, stmt, rs);            databaseUtility.close(conn, stmt, rs2);            databaseUtility.close(conn, stmt, rs3);            databaseUtility.close(conn, stmt, rs4);        }        System.out.println("doSave() end!!!");		return gdRes;	}//	public GridData doCreData(GridData gdReq) throws Exception {////		System.out.println("doCreData() start!!!");//		conn = databaseUtility.getConnection("t3sinc"); // DB Connection//		stmt = conn.createStatement(); // statement 객체 생성////		GridData gdRes = new GridData(); // WiseGrid 객체생성////		int rowCount = 0; // CRUD 컬럼 row 수//		//		System.out.println("Total Row Count : " + gdReq.getHeader("ITEM_ID").getRowCount());////		try {////			// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.//			rowCount			= gdReq.getHeader("CRUD").getRowCount();//			String cnfm_date 	= gdReq.getParam("cnfm_date");//			//			if(rowCount == 0) {//				gdRes.addParam("mode", "Save");//				gdRes.setMessage("성공적으로 작업하였습니다._저장데이터 없음.");//				gdRes.setStatus("true");//				return gdRes;//			}////			System.out.println("CRUD Row Count : " + rowCount);////			//String user_id = gdReq.getParam("user_id");//			String sql, inner_sql, sql2, inner_sql2, sql3, inner_sql3;//			//			//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!	//			sql  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";//			sql += "	( 																												\n";//			sql += "	SELECT																											\n";//			sql += "			T1.ITEM_ID, T1.BASE_DAY, T2.NEW_BASE_DAY																\n";//			sql += "	FROM	ITEM_MST	T1,                                                                                        	\n";//			sql += "			(                                                                                                      	\n";//			boolean flag = false;//			// 데이터 셋팅//			for (int i = 0; i < rowCount; i++) {//				System.out.println("어디에서 에러 !! 1 : ");//				//				String crud = gdReq.getHeader("CRUD").getValue(i);//				System.out.println("crud ="+crud);//				if(crud.equals("U")) {//					if( flag){//						sql += "UNION	ALL \n"; //					}//					flag = true;//					//파라미터를 변수에 적용!!  //					inner_sql  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";//					inner_sql += "				'" + gdReq.getHeader("BASE_DAY").getValue(i)		+ "'	AS NEW_BASE_DAY	    	\n";//					inner_sql += "	FROM	DUAL			                                                  													\n";//					sql += inner_sql;//					if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.//						sql += "	UNION	ALL \n" + inner_sql;//					}//				}//									//			}//for문 끝.//			sql += "			)			T2                                                                                      \n";//			sql += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";//			sql += "	)                                                                                                        	\n";//			sql += "	SET		BASE_DAY = NEW_BASE_DAY														                  	\n";////			System.out.println("-----------------------------------------------QUERY_1-----------------------------------------------");//			System.out.println(sql);//			System.out.println("-----------------------------------------------QUERY_1-----------------------------------------------");////			//			//			//			//			////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////			//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!	//			sql2  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";//			sql2 += "	( 																												\n";//			sql2 += "	SELECT																											\n";//			sql2 += "			T1.ITEM_ID, T1.LST_PRODQTY, T2.NEW_LST_PRODQTY															\n";//			sql2 += "	FROM	PLANT_ALLOC_ITEM_ADJ	T1,                                                                                        	\n";//			sql2 += "			(                                                                                                      	\n";//			boolean flag2 = false;//			// 데이터 셋팅//			for (int i = 0; i < rowCount; i++) {//				System.out.println("어디에서 에러 !! 1 : ");//				//				String crud = gdReq.getHeader("CRUD").getValue(i);//				System.out.println("crud ="+crud);//				if(crud.equals("U")) {//					if( flag2){//						sql2 += "UNION	ALL \n"; //					}//					flag2 = true;//					//파라미터를 변수에 적용!!  //					inner_sql2  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";//					inner_sql2 += "				'" + gdReq.getHeader("W1_PROD_QTY").getValue(i)		+ "'	AS NEW_LST_PRODQTY    	\n";//					inner_sql2 += "	FROM	DUAL			                                                  													\n";//					sql2 += inner_sql2;//					if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.//						sql2 += "	UNION	ALL \n" + inner_sql2;//					}//				}//									//			}//for문 끝.//			sql2 += "			)			T2                                                                                      \n";//			sql2 += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";//			sql2 += "	AND		T1.VERSION	LIKE REPLACE('" + cnfm_date + "','-','')||'%'                                         \n";//			sql2 += "	AND		T1.DUE_DATE	= TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "')+7,'D')+6,'YYYY-MM-DD')-- 차주 토요일로 공장할당 조정물량 입력		\n";//			sql2 += "	)                                                                                                        	\n";//			sql2 += "	SET		LST_PRODQTY = NEW_LST_PRODQTY													                  	\n";////			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");//			System.out.println(sql2);//			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");//			//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////			//			//			//			//해당 버젼이 있을경우에는 (MERGE 문 업데이트나 인설트를) 실행!!	//			sql3  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";//			sql3 += "	( 																												\n";//			sql3 += "	SELECT																											\n";//			sql3 += "			T1.ITEM_ID, T1.LST_PRODQTY, T2.NEW_LST_PRODQTY															\n";//			sql3 += "	FROM	PLANT_ALLOC_ITEM_ADJ	T1,                                                                                        	\n";//			sql3 += "			(                                                                                                      	\n";//			boolean flag3 = false;//			// 데이터 셋팅//			for (int i = 0; i < rowCount; i++) {//				System.out.println("어디에서 에러 !! 1 : ");//				//				String crud = gdReq.getHeader("CRUD").getValue(i);//				System.out.println("crud ="+crud);//				if(crud.equals("U")) {//					if( flag3){//						sql3 += "UNION	ALL \n"; //					}//					flag3 = true;//					//파라미터를 변수에 적용!!  //					inner_sql3  = "	SELECT		'" + gdReq.getHeader("ITEM_ID").getValue(i) 		+ "'	AS ITEM_ID, 			\n";//					inner_sql3 += "				'" + gdReq.getHeader("W3_PROD_QTY").getValue(i)		+ "'	AS NEW_LST_PRODQTY    	\n";//					inner_sql3 += "	FROM	DUAL			                                                  													\n";//					sql3 += inner_sql3;//					if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.//						sql3 += "	UNION	ALL \n" + inner_sql3;//					}//				}//									//			}//for문 끝.//			sql3 += "			)			T2                                                                                      \n";//			sql3 += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                            \n";//			sql3 += "	AND		T1.VERSION	LIKE REPLACE('" + cnfm_date + "','-','')||'%'                                         \n";//			sql3 += "	AND		T1.DUE_DATE	= TO_CHAR(TRUNC(TO_DATE('" + cnfm_date + "')+14,'D')+6,'YYYY-MM-DD')-- 차주 토요일로 공장할당 조정물량 입력		\n";//			sql3 += "	)                                                                                                        	\n";//			sql3 += "	SET		LST_PRODQTY = NEW_LST_PRODQTY													                  	\n";////			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");//			System.out.println(sql3);//			System.out.println("-----------------------------------------------QUERY_2-----------------------------------------------");//			//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////			//			//			System.out.println("executeQuery 실행!!!");//			//			rs = databaseUtility.executeQuery(stmt, sql);//			rs2 = databaseUtility.executeQuery(stmt, sql2);//			rs3 = databaseUtility.executeQuery(stmt, sql3);			//			System.out.println("executeQuery 종료!!!");//			//			/*//			 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다//			 *///			gdRes.addParam("mode", "cre_data");//			gdRes.setMessage("성공적으로 작업하였습니다.");//			gdRes.setStatus("true");//			//		}catch (Exception e) {//			throw e;//		}finally {//            databaseUtility.close(conn, stmt, rs);//            databaseUtility.close(conn, stmt, rs2);//            databaseUtility.close(conn, stmt, rs3);//        }////        System.out.println("doCreData() end!!!");////		return gdRes;//	}	//	//	// 공급할당정보 저장//	public GridData doSave_dev(GridData gdReq) throws Exception {////			System.out.println("doSave() start!!!");////			conn = databaseUtility.getConnection("t3sinc"); // DB Connection//			stmt = conn.createStatement(); // statement 객체 생성////			GridData gdRes = new GridData(); // WiseGrid 객체생성////			int rowCount = 0; // CRUD 컬럼 row 수//			int union_check = 0; // UNION ALL 포함여부 CHECK////			try {////				// 화면에서 전달받은 "CRUD"의 row 수를 가져온다.//				rowCount = gdReq.getHeader("CRUD").getRowCount();//				//				String mode = gdReq.getParam("mode");//				//				//String p_plant_alloc_version = gdReq.getParam("plant_alloc_version");//				String cnfm_date 	= gdReq.getParam("cnfm_date");//				//String p_sdate  = gdReq.getParam("cnfm_date");//				//String P_checked_domain  = gdReq.getParam("checked_domain");//				String made_by = gdReq.getParam("user_id");////				String version = "";//				String item_id = "";//				String due_date = ""; //차주 해당 토요일//				//				//				// 차주 공장할당 W+1 주//				String w1_lst_prodqty = "";//				//				// 차차주 공장할당 W+2 주//				String w2_lst_prodqty = "";////				//				// 기준일수//				String base_day = "";//				//				String crud = "";//				//				//System.out.println("p_plant_alloc_version : "+p_plant_alloc_version);//				System.out.println("p_sdate : "+cnfm_date);//				//System.out.println("P_checked_domain : "+P_checked_domain);//				//				//보정할 건수가 없을때 오류안나게하기위해.//				if(rowCount == 0) {//					gdRes.addParam("mode", "save");//					gdRes.setMessage("성공적으로 작업하였습니다.");//					gdRes.setStatus("true");//					return gdRes;//				}//				//				System.out.println("CRUD Row Count : " + rowCount);//				//				String sql = "";//				String sql2 = "";//				String sql3 = "", inner_sql = "";//				//				// PLANT_ALLOC_ITEM_ADJ W+1 주 저장 query	//				sql  = "merge into PLANT_ALLOC_ITEM_ADJ PA 																					\n";//				sql += "using ( 																											\n";//				//				// PLANT_ALLOC_ITEM_ADJ W+2 주 저장 query	//				sql2  = "merge into PLANT_ALLOC_ITEM_ADJ PA 																				\n";//				sql2 += "using ( 																											\n";////				//				// ITEM_MST의 기준일수 (BASE_DAY)저장 query//				sql3  = "	UPDATE  /*+ bypass_ujvc*/ 																						\n";//				sql3 += "	( 																												\n";//				sql3 += "	SELECT	T1.BASE_DAY, T2.BASE_DAY NEW_BASE_DAY																	\n";//				sql3 += "	FROM	ITEM_MST	T1,                                                                                        	\n";//				sql3 += "			(                                                                                                      	\n";			//				//				// 데이터 셋팅//				for (int i = 0; i < rowCount; i++) {//					//					if(gdReq.getHeader("ITEM_ID").getValue(i).equals("소계") || gdReq.getHeader("ITEM_NAME").getValue(i).equals("총계")){//						System.out.println("ITEM_ID가 소계이거나 ITEM_NAME이 총계일때는 아무것도 실행안함!!!!");//					}//					else {//						 //						if( union_check > 0){//							sql	 += "		union all \n"; //							sql2 += "		union all \n";//							sql3 += "		union all \n"; //						}//						crud = gdReq.getHeader("CRUD").getValue(i);//						System.out.println(gdReq.getHeader("ITEM_NAME").getValue(i));	//						System.out.println(crud);					 //						 //						//파라미터를 변수에 적용!!//						 //version		= p_plant_alloc_version;//						 item_id		= gdReq.getHeader("ITEM_ID").getValue(i);//						 due_date		= cnfm_date;//						 w1_lst_prodqty	= gdReq.getHeader("W1_PROD_QTY").getValue(i);//						 w2_lst_prodqty	= gdReq.getHeader("W3_PROD_QTY").getValue(i);//						 base_day		= gdReq.getHeader("BASE_DAY").getValue(i);//							//						//----------------------------------------- W+1 주차 공장할당 merge into ------------------------------------------------//						sql +=	"		select '" + version 									+ "' AS VERSION, " 		+//								"				'" + item_id 									+ "' AS ITEM_ID, " 		+ //								"				TRUNC(TO_DATE('" + due_date + "'),'D')+13 			 AS DUE_DATE, " 	+//								"				TO_NUMBER(REPLACE('" + w1_lst_prodqty + "',',',''))  AS LST_PRODQTY, " 	+//								"				'" + made_by 									+ "' AS MADE_BY " 		+//								"		from	DUAL 																				\n";//						//-------------------------------------------------------------------------------------------------------------------					 ////						//----------------------------------------- W+2 주차 공장할당 merge into ------------------------------------------------//						sql2 +=	"		select '" + version 									+ "' AS VERSION, " 		+//								"				'" + item_id 									+ "' AS ITEM_ID, " 		+ //								"				TRUNC(TO_DATE('" + due_date + "'),'D')+20 			 AS DUE_DATE, " 	+//								"				TO_NUMBER(REPLACE('" + w2_lst_prodqty + "',',',''))  AS LST_PRODQTY, " 	+//								"				'" + made_by 									+ "' AS MADE_BY " 		+//								"		from	DUAL 																				\n";//						//-------------------------------------------------------------------------------------------------------------------					 ////						//						//----------------------------------------- ITEM_MST "기준일수" UPDATE ------------------------------------------------//						inner_sql  = "		SELECT		'" + item_id 		+ "'				AS ITEM_ID, 					\n";//						inner_sql += "					'" + base_day	 	+ "'	 	        AS BASE_DAY						\n";					//						inner_sql += "		FROM		DUAL																	\n";					//						//-------------------------------------------------------------------------------------------------------------------//						//						sql3 += inner_sql;//						//						if(rowCount == 1){ // update건수가 1건인 경우 ora-01732에러가 발생한다. 이유모름. 따라서 1건인 경우 강제로 두건으로 만든다.//							sql3 += "UNION	ALL \n" + inner_sql;//						}//						//						union_check++;//					}////				}//for문 끝.//				//				sql  += ") PP \n";//				sql2 += ") PP \n";//				//				//---------------------------------------------------------------------------------------------------------------------//				sql += "on		(PA.VERSION 	= PP.VERSION                                                                       \n";//				sql += "AND 	PA.ITEM_ID		= PP.ITEM_ID                                                                       \n";//				sql += "AND 	PA.DUE_DATE		= PP.DUE_DATE)                                                                     \n";//				sql += "when	matched then update set                                                                            \n";//				sql += "     	PA.LST_PRODQTY	= PP.LST_PRODQTY,                                                                  \n";//				sql += "     	PA.MADE_TYPE	= 'UP',                                                                            \n";//				sql += "     	PA.MADE_DTTM	= SYSDATE,                                                                         \n";//				sql += "     	PA.MADE_BY		= PP.MADE_BY                                                                       \n";//				sql += "when not matched then " +//					   "insert(PA.VERSION, PA.ITEM_ID, PA.DUE_DATE, PA.LST_PRODQTY, PA.MADE_TYPE,	PA.MADE_DTTM,	PA.MADE_BY)    \n";//				sql += "values(PP.VERSION, PP.ITEM_ID, PP.DUE_DATE, PP.LST_PRODQTY, 'AD', 			SYSDATE, 		PP.MADE_BY)    \n";////				//---------------------------------------------------------------------------------------------------------------------//				sql2 += "on		(PA.VERSION 	= PP.VERSION                                                                       \n";//				sql2 += "AND 	PA.ITEM_ID		= PP.ITEM_ID                                                                       \n";//				sql2 += "AND 	PA.DUE_DATE		= PP.DUE_DATE)                                                                     \n";//				sql2 += "when	matched then update set                                                                            \n";//				sql2 += "     	PA.LST_PRODQTY	= PP.LST_PRODQTY,                                                                  \n";//				sql2 += "     	PA.MADE_TYPE	= 'UP',                                                                            \n";//				sql2 += "     	PA.MADE_DTTM	= SYSDATE,                                                                         \n";//				sql2 += "     	PA.MADE_BY		= PP.MADE_BY                                                                       \n";//				sql2 += "when not matched then " +//					   "insert(PA.VERSION, PA.ITEM_ID, PA.DUE_DATE, PA.LST_PRODQTY, PA.MADE_TYPE,	PA.MADE_DTTM,	PA.MADE_BY)    \n";//				sql2 += "values(PP.VERSION, PP.ITEM_ID, PP.DUE_DATE, PP.LST_PRODQTY, 'AD', 			SYSDATE, 		PP.MADE_BY)    \n";////				//				//				//---------------------------------------------------------------------------------------------------------------------//				sql3 += "			)			T2                                                                                 \n";//				sql3 += "	WHERE	T1.ITEM_ID	= T2.ITEM_ID                                                                       \n";//				sql3 += "	)                                                                                                      \n";//				sql3 += "	SET		BASE_DAY = NEW_BASE_DAY																 		   \n";//				//				System.out.println("-----------------------------------------------QUERY-----------------------------------------------");//				System.out.println(sql);//				System.out.println("-----------------------------------------------QUERY-----------------------------------------------");//				//				System.out.println("sql executeQuery 실행!!!");//				// TEST 용으로 주석처리//				rs = databaseUtility.executeQuery(stmt, sql);//				//				System.out.println("sql executeQuery 종료!!!");////				System.out.println("-----------------------------------------------QUERY2-----------------------------------------------");//				System.out.println(sql2);//				System.out.println("-----------------------------------------------QUERY2-----------------------------------------------");//				//				System.out.println("sql executeQuery 실행!!!");//				// TEST 용으로 주석처리//				rs = databaseUtility.executeQuery(stmt, sql2);//				//				System.out.println("sql executeQuery 종료!!!");////				//				//				System.out.println("-----------------------------------------------QUERY3-----------------------------------------------");//				System.out.println(sql3);//				System.out.println("-----------------------------------------------QUERY3-----------------------------------------------");//				//				System.out.println("sql3 executeQuery 실행!!!");//				//				rs = databaseUtility.executeQuery(stmt, sql3);//				//				System.out.println("sql3 executeQuery 종료!!!");//				//				/*//				 * 화면에 전달할 파라미터를 설정한다. 메세지를 셋팅한다. Status를 설정한다//				 *///				gdRes.addParam("mode", "save");//				gdRes.setMessage("성공적으로 작업하였습니다.");//				gdRes.setStatus("true");////			} catch (Exception e) {//				throw e;//			} finally {//		        databaseUtility.close(conn, stmt, rs);              //		    }//			System.out.println("doSave() end!!!");////			return gdRes;//		}				}                                                                                                                            