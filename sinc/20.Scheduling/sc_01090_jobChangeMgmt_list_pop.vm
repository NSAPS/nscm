#############################################################################################################################################
## 프로그램ID : sc_11020_dailyProductionPlanAnalysisNew_popup.vm
## 프로그램명 : 일간생산계획 분석(재구성) - 수정화면(POPUP)
## 개발자  : 정재교
## 개발일자 : 2008-11-27 목요일
##
##관련 job file : job_sinc_20_scheduling_00.xml
##
##관련 query file : query_sinc_20_scheduling_00.xml
##
## REVISIONS
## VER        DATE        AUTHOR    DESCRIPTION
## ---------  ----------  --------  ------------------------------------
## 1.0        2008-11-27  정재교          sc_11020_dailyProductionPlanAnalysisNew_popup.vm 개발
##
##
#############################################################################################################################################
## 비정상적 접근 방지 
#loginCheck() 
## 화면 resizing 을 위한 function 호출 코드
#set( $resizeFuncCallCode = "setHtmlGridAutoResize2('107', '432')" ) 

## 전달 받은 변수 저장
<script type='text/javascript' src='${project}/dwr/interface/commonUtil.js'></script>
<script type='text/javascript' src='${project}/dwr/interface/scheduling.js'></script>
<script type='text/javascript' src='${project}/dwr/engine.js'></script>
<script type='text/javascript' src='${project}/dwr/util.js'></script>    



<body onUnLoad="exit('-1');">
    <table border="0" width="100%" height="100%" cellpading="0" cellspacing="0">
        ## 기능 버튼 영역
        <script> 
            var buttonString = "";
            buttonString = "<input type=\"button\" name=\"btnExecIF\" id=\"btnExecIF\" value=\" 조회\" onClick=\"GoSearch('xx'); \" class=\"btn_search_on\">";
            buttonString+= "<input type=\"button\" name=\"btnExecIF\" id=\"btnExecIF\" value=\" 저장\" onClick=\"GoSave('xx'); \" class=\"btn_sav_on\">";
            areaBtn.innerHTML = " &nbsp;" + buttonString;
        </script>
        
        ## 조회 영역
        <tr>
            <td width="100%" valign="top">
                <table border="0" width="100%" cellpading="0" cellspacing="0">
                    <tr height="2"><td colspan="3" style="background-color:#d0d0d0; " onClick="OpenClose(search_menu); $!{resizeFuncCallCode}; "></td></tr>
                    <tr>
                        <td width="2" style="background-color:#d0d0d0; " onClick="OpenClose(search_menu); $!{resizeFuncCallCode}; "></td>
                        <td width="100%">
                            <table id="search_menu" border="0" width="100%" cellpading="0" cellspacing="0" 
                            style="background-color:#f2f2f2; display:block; ">
                                <tr>
                                    <td width="7%" align="right">
                                        공장 ($!plant_id) :
                                    </td> 
                                    <td width="7%" align="left" >
                                        <input type="text" name="txt_plant_name" size="100"  style="width:80px; text-align:left; " class="normal" value="$plant_name" readOnly >
                                    </td>
                                    <td width="10%" align="right">
                                        라인 ($line_id) :
                                    </td>
                                    <td width="20%" align="left" >
                                        <input type="text" name="txt_line_name" size="100"  style="width:155px; text-align:left; " class="normal" value="$line_name" readOnly>
                                    </td>                                                                
                                    <td width="10%" align="right">
                                        작업장 ($proc_id) :
                                    </td>
                                    <td width="20%" align="left">
                                        <input type="text" name="txt_proc_name" size="100"  style="width:155px; text-align:left; " class="normal" value="$proc_name" readOnly>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td width="2" style="background-color:#d0d0d0; " onClick="OpenClose(search_menu); $!{resizeFuncCallCode}; "></td>
                    </tr>
                    <tr height="2"><td colspan="3" style="background-color:#d0d0d0; " onClick="OpenClose(search_menu); $!{resizeFuncCallCode}; "></td></tr>
                </table>
            </td>
        </tr>
        
        <tr><td height="5"></td></tr>
        ## TAB 영역
        <tr>
            <td valign="top">
                ## tab 좌측 여백
                <table name="grid" width="100%" border="0" cellpading="0" cellspacing="0" class="normal-table">
                    <tr>
                        <td align="left">
                            <script>initWiseGrid("WiseGrid", "100%", "400");</script>
                        </td>
                    </tr>
                </table> 
                
                <input type="hidden" name="_moon_service">
                <input type="hidden" name="_moon_pagenumber" value="$!{_moon_pagenumber}">
                <input type="hidden" name="_moon_perpage" value="$!{_moon_perpage}">
    			<input type="hidden" name="_user_id" value="$!{_user_id}">
                
                ## 번호 배경색
                <input name="searchBgcolor" type="hidden" value="${search_bgcolor}">                    
            </td>
        </tr>
    </table>
</body>


<script>
    // 도움말 내용 입력
    var helpStr = "◈ Job Change 추가 화면";
    helpStr += "<br>◈ J/C가 될 수 있는 조건의 모든 데이터를 화면에 출력 하고";
    helpStr += "<br>◈ 해당 건에 대한 J/C Time(분) 이나 Box수량을 입력 합니다.";
    helpStr += "<br>◈ 수정 후에는 '저장' 버튼을 누릅니다.";
    helpStr += "<br>◈ 'X'로 창을 닫으면 JobChange 시간관리 조회화면에 추가된 결과가 출력 됩니다.";
    helpCont.innerHTML = helpStr;
    hDynamicHeight = 0;

   var pageID = "sc_01090_jobChangeMgmt_list_pop";
   var pageID_Save = "sc_01090_jobChangeMgmt_lst";
   var GridObj = document.WiseGrid;
   var GridHeaderString = "";






/*┌──────────────────────────────────┐
  │WiseGrid 오브젝트가 생성되고 초기화된 후 발생하는 
  │JavaScript Event인 Initialize()를 받아 그리드의 헤더를 셋팅한다.
  └──────────────────────────────────┘*/
   function init() {
       setProperty(GridObj);//WiseGrid Default설정 부분 (WiseGrid_Property.js파일 내에 선언되어 있다.)
       setDefault();        //화면 기본 설정 
       setHeader(GridObj);  //해더생성 
       
       doQuery();
   }
   
/*┌──────────────────────────────────┐
  │화면 기본 설정 부분.
  └──────────────────────────────────┘*/
   function setDefault()
   {


   }




   	
/*┌──────────────────────────────────┐
  │해더생성
  └──────────────────────────────────┘*/
   function setHeader(GridObj) 
   {		
       GridObj.AddHeader("CRUD"          ,"구분"       ,"t_text" ,10  ,55  ,false);                                                                                 
       GridObj.AddHeader("PLANT"         ,"Code"       ,"t_text" ,20  ,40  ,false); //0                                                                               
       GridObj.AddHeader("PLANT_NM"      ,"Name"       ,"t_text" ,20  ,80  ,false); //1                                                                               
       GridObj.AddHeader("LINE_ID"       ,"Code"       ,"t_text" ,18  ,40  ,false); //2                                                                               
       GridObj.AddHeader("LINE_NM"       ,"Name"       ,"t_text" ,200 ,160 ,false); //3                                                                               
       GridObj.AddHeader("PROC_ID"       ,"Code"       ,"t_text" ,18  ,45  ,false); //4                                                                               
       GridObj.AddHeader("PROC_NM"       ,"Name"       ,"t_text" ,200 ,160 ,false); //5                                                                               
       GridObj.AddHeader("FROM_GROUP"    ,"Code"       ,"t_text" ,18  ,70  ,false); //6                                                                               
       GridObj.AddHeader("FROM_GROUP_NM" ,"Name"       ,"t_text" ,200 ,160 ,false); //7                                                                               
       GridObj.AddHeader("TO_GROUP"      ,"ID"         ,"t_text" ,18  ,70  ,false); //8                                                                               
       GridObj.AddHeader("TO_GROUP_NM"   ,"Name"       ,"t_text" ,200 ,160 ,false); //9                                                                               
       GridObj.AddHeader("JC_TIME"       ,"J/C Time"   ,"t_text" ,10  ,60  ,true ); //10                                                                              
       GridObj.AddHeader("BOX_QTY"       ,"BOX"        ,"t_text" ,10  ,60  ,true ); //11 
       
                                                                                   
       
       //해더 그룹생성
       GridObj.AddGroup("PLANTGROUP","공장");
       GridObj.AppendHeader("PLANTGROUP","PLANT");
       GridObj.AppendHeader("PLANTGROUP","PLANT_NM");

       GridObj.AddGroup("LINEGROUP","라인");
       GridObj.AppendHeader("LINEGROUP","LINE_ID");
       GridObj.AppendHeader("LINEGROUP","LINE_NM");

       GridObj.AddGroup("PROCGROUP","작업장");
       GridObj.AppendHeader("PROCGROUP","PROC_ID");
       GridObj.AppendHeader("PROCGROUP","PROC_NM");

       GridObj.AddGroup("FROMGROUP","From 그룹");
       GridObj.AppendHeader("FROMGROUP","FROM_GROUP");
       GridObj.AppendHeader("FROMGROUP","FROM_GROUP_NM");
       
       GridObj.AddGroup("TOGROUP","To 그룹");
       GridObj.AppendHeader("TOGROUP","TO_GROUP");
       GridObj.AppendHeader("TOGROUP","TO_GROUP_NM");

   	   GridObj.BoundHeader();	
   	   
   	   //해더 Hidden
   	   GridObj.SetColHide("CRUD"     , true);
       GridObj.SetColHide("PLANT"    , true);   
       GridObj.SetColHide("PLANT_NM" , true);   
       GridObj.SetColHide("LINE_ID"  , true);   
       GridObj.SetColHide("LINE_NM"  , true);   
       GridObj.SetColHide("PROC_ID"  , true);   
       GridObj.SetColHide("PROC_NM"  , true);   
   	   
   	   GridObj.SetCRUDMode("CRUD", "추가", "수정", "삭제"); //수정,삭제,추가 구분 부분.
   }
   	

/*┌──────────────────────────────────┐
  │화면에 '조회'를 누르면 호출 Fnc
  └──────────────────────────────────┘*/
   function GoSearch(service) 
   {
       doQuery();
   }
  
  
  
  
/*┌──────────────────────────────────┐
  │화면에 '저장'를 누르면 호출 Fnc
  └──────────────────────────────────┘*/
   function GoSave  (service)
   {
	    var servlet_url = Project_name+"/servlet/com.wisegrid.admin."+pageID_Save;
    
    	//WiseGrid가 서버에 전송할 mode를 셋팅한다.
    	GridObj.SetParam("mode", "save");
    	GridObj.SetParam("_user_id",document.all._user_id.value);
    
    	//WiseGrid가 서버와 통신시에 데이터를 전달한
    	GridObj.DoQuery(servlet_url, "CRUD");
    	
   }
      
   
/*┌──────────────────────────────────┐
  │조회 쿼리를 호출 Fnc
  └──────────────────────────────────┘*/
   function doQuery() 
   {
       var plant_id = "$plant_id";           
       var line_id  = "$line_id";  
       var proc_id  = "$proc_id";
       
       var servlet_url = Project_name+"/servlet/com.wisegrid.admin."+pageID;

       //넘겨줄 값들을만든다.( 파라미터 정의 부분 )
       GridObj.SetParam("mode", "search");
       GridObj.SetParam("plant_id", plant_id);
       GridObj.SetParam("line_id", line_id);
       GridObj.SetParam("proc_id", proc_id);
       GridObj.DoQuery(servlet_url);
       
       GridObj.ClearGrid() 
       setHeader(GridObj);  //해더생성 
   }


/*┌──────────────────────────────────┐
  │데이터 조회가 정상적으로 완료되면 발생되는 Event에 대한 Fnc
  └──────────────────────────────────┘*/
    function GridEndQuery() 
    {
        var mode = GridObj.GetParam("mode");
        var error_msg = '';
        if(mode == "search") //조회가 완료된 경우
        {
            if(GridObj.GetStatus() == "true") 
            {                                                    
                //데이터를 그룹핑 한다.                                                     
                GridObj.SetGroupMerge("PLANT,PLANT_NM,LINE_ID,LINE_NM,PROC_ID,PROC_NM,FROM_GROUP,FROM_GROUP_NM");                                                    
                GridObj.SetColCellAlign('JC_TIME','right') 
                GridObj.SetColCellAlign('BOX_QTY','right') 
            } else	
            { 
                error_msg = GridObj.GetMessage(); 
                alert(error_msg);			
            }
        } else if(mode=='save') { //저장이 완료된 경우 
            if(GridObj.GetStatus() == "true") 
        	{
        	    doQuery() ;
            } else	{
                error_msg = GridObj.GetMessage();
                alert(error_msg);			
            }
        }
    }
     
/*┌──────────────────────────────────┐
  │그리드의 데이터가 변경 되었을 경우 처리되는 Fnc
  └──────────────────────────────────┘*/
   function GridChangeCell(strColumnKey, nRow) 
   {
   	/*
   	if(strColumnKey != "SELECTED") {
   		//??? ? SELECTED ?? ??? ??? ?? ???. 
   		GridObj.SetCellValue("SELECTED", nRow, "1");
   	}
   	*/
   }   
   
/*┌──────────────────────────────────┐
  │그리드의 원 클릭 이벤트
  └──────────────────────────────────┘*/
   function GridCellClick(strColumnKey, nRow){
   }		
        
        
        
        
/*┌──────────────────────────────────┐
  │창을 닫을때 발생되는 Fnc
  └──────────────────────────────────┘*/
   function exit(returnValue)
   {
        window.returnValue = returnValue;
        window.close();
   }        
        
</script> 



