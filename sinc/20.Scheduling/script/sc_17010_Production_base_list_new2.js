//############################################################//## Щ煎斜極ID      : sc_17010_Production_base_list_new2.vm//## Щ煎斜極貲      : 熱轎螃渦 儅骯蹂羶橾 婦葬//## 偃嫦濠          : 陴錠辨//## 偃嫦橾濠        : 2009-07-20//##//## 婦溼 job file   : job_sc_17010_production_base_list_new.xml//## 婦溼 query file : query_sc_17010_production_base_list_new.xml//##//## REVISIONS//## VER        DATE        AUTHOR    DESCRIPTION//## ---------  ----------  --------  ------------------------------------//## 1.0        2009-07-20  陴錠辨      create//## 1.1		2014-09-30  檜鬼遵	   update//############################################################/************************************************************************************************************************************//**********************************************  WiseGrid Java Script   *************************************************************//************************************************************************************************************************************///-----------------------------------------             瞪羲 滲熱            ----------------------------------------------////var mode;														// WiseGrid 鱔褐 衛 瞪歎 賅萄(search, save, ... etc)var class_path = "com.wisegrid.admin.";							// 憮綰葩 ぬ酈雖(class だ橾 唳煎)var job_id = 'sc_17010_Production_base_list_new2';var GridObj ; 													// WiseGrid 偌羹var GridObj2;var GridObj3;var color_tot = '234|234|234';			//м啗 塭檣 寡唳儀var color_edit_col = '255|253|208';var color_sp = '230|222|230'; 			//鏽歲 掘碟摹 寡唳儀var color_select_row = '141|232|141';	//塭檣 摹鷗 寡唳儀var colBg01 = '224|255|224';			//255|255|153var colBg02 = '255|255|255';var col_yellow = '255|246|18';/*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛WiseGrid 螃粽薛お陛 儅撩腎堅 蟾晦音  嫦儅ж朝 							弛  弛JavaScript Event檣 Initialize()蒂 嫡嬴 斜葬萄曖 ④渦蒂 撢たи棻.			弛  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/function init() {    	GridObj = document.WiseGrid;		setProperty(GridObj);	//WiseGrid Default撲薑 睡碟 (WiseGrid_Property.jsだ橾 頂縑 摹樹腎橫 氈棻.)	setHeader(GridObj);  	//п渦儅撩 	setDefault();        	//飛 晦獄 撲薑 }      /*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛飛 晦獄 撲薑 睡碟.  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/function setDefault() {     GridObj.nHDLineSize         = 16; //Header Size    //摹鷗脹 撚曖 旋濠儀 雖薑и棻.    GridObj.strSelectedCellFgColor = '180|82|205';    GridObj.strHDClickAction = "select";        	//贗葛и 鏽歲曖 撚擊 摹鷗陛棟ж啪 и棻.	//GridObj.strActiveRowBgColor = "170|170|170";    //摹鷗脹 ч曖 寡唳儀鼻擊 撲薑и棻.        // 蝶觼煤 樓紫 : page 欽嬪 scroll ->晦獄擎 'default'    GridObj.strMouseWheelAction='page';           //④渦曖 塭檣熱蒂 撲薑и棻.     GridObj.nHDLines = 2;                   }       /*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛п渦儅撩  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/function setHeader(GridObj) {        	var cnfm_date = document.all.cnfm_date.value;	commonUtil.getSelQeury( "cnfm_date", cnfm_date, "sc_17010_W1_DAY",{		callback:function(result){		var sc_17010_W1_DAY = result[0][0];			GridObj.AddHeader("CRUD"			,"CRUD"       		,"t_text" 	,100    ,50  ,false);	GridObj.AddHeader("SALES_CAT03"		,"ヶ謙(醞)"       	,"t_text" 	,20		,70  ,false); //0	GridObj.AddHeader("SALES_CAT_SCM"	,"ヶ謙(模)"       	,"t_text" 	,20		,70  ,false); //0	GridObj.AddHeader("ITEM_ID"			,"薯ヶ囀萄"       	,"t_text" 	,20		,70  ,false); //0    	GridObj.AddHeader("ITEM_NAME"		,"薯ヶ貲"     	  	,"t_text" 	,400	,170 ,false); //0  	GridObj.AddHeader("SALES_MEAN_1WEEK","1輿ゎ敕っ衙"    	,"t_number" ,20.3	,71  ,false); //0 	GridObj.AddHeader("SALES_MEAN_3WEEK","3輿ゎ敕っ衙"    	,"t_number" ,20.3	,71  ,false); //0 	GridObj.AddHeader("FRC_QTY"			,"橾ゎ敕\nっ衙蕨鼻榆"	,"t_number" ,20.3	,71  ,true); //0 	GridObj.AddHeader("BASE_DAY"		,"っ衙橾熱"    		,"t_number" ,20.3	,71  ,true); //0 	GridObj.AddHeader("SALES_EXPT"		,"っ衙蕨鼻榆"    		,"t_number" ,20.3	,71  ,false); //0 	GridObj.AddHeader("BASE_CP_DAY"		,"っ衙爾薑橾熱"    	,"t_number" ,20.3	,81  ,true); //0 	GridObj.AddHeader("PRODUCE_TERM"	,"儅骯衛晦"			,"t_number" ,20.3	,71  ,true); //0 	GridObj.AddHeader("PRE_STOCK_DAY"	,"餌瞪綠蹴橾熱"		,"t_number" ,20.3	,81  ,true); //0 	GridObj.AddHeader("TOT_SAFE_DAY"	,"識 寰瞪營堅橾熱"	,"t_number" ,20.3	,101  ,false); //0 	GridObj.AddHeader("SAFE_STOCK_QTY"	,"寰瞪營堅榆"			,"t_number" ,20.3	,71  ,false); //0 	//    	GridObj.AddHeader("EVENT_QTY"		,"檜漸お僭榆"			,"t_number" ,20.3	,71  ,true); //0 	GridObj.AddHeader("TOT_SUPPLY_QTY"	,"識奢晝в蹂榆"		,"t_number" ,20.3	,91  ,false); //0 	GridObj.AddHeader("W0_BASE_STOCK"	,"旎輿\n晦蟾營堅"       ,"t_number" ,20.3	,71  ,false); //0    	 	GridObj.AddHeader("W0_PROD_QTY"		,"旎輿\n儅骯啗"    	,"t_number" ,20.3	,71  ,false); //0    	GridObj.AddHeader("W0_SUPPLY_QTY"	,"旎輿\n奢晝陛棟榆"   ,"t_number" ,20.3	,71  ,false); //0   	GridObj.AddHeader("PROD_DEMAND_QTY"	,"儅骯蹂羶榆"       	,"t_number" ,20.3	,71  ,false); //0   	 	GridObj.AddHeader("PROD_PLAN_QTY"	,"儅骯啗僩"       	,"t_number" ,20.3	,71  ,true); //0 	GridObj.AddHeader("W1_PROD_PLAN"	,"離輿輿除\n儅骯啗"	,"t_number" ,20.3	,71  ,false); //0  	GridObj.AddHeader("PROD_PLAN_SUB"	,"儅骯啗鈾n離檜榆"	,"t_number" ,20.3	,71  ,false); //0    	GridObj.AddHeader("PROD_PLAN_QTY2"	,"離輿\n儅骯啗僩"	,"t_number" ,20.3	,0  ,true); //0   薯剪 2014-11-10 檜蝓辨 蹂 	GridObj.AddHeader("PROD_PLAN_SAFE_QTY"	,"儅骯啗凳暆琵n 寰瞪營堅榆"	,"t_number" ,20.3	,81  ,true); //0  	 	GridObj.BoundHeader();		GridObj.SetCRUDMode("CRUD");  // AD諦 DE陛 撢た 腆 唳辦朝 橈棻.		GridObj.SetColFix('ITEM_NAME');		GridObj.SetNumberFormat("SALES_MEAN_1WEEK" 		,"#,##0.#");	GridObj.SetNumberFormat("SALES_MEAN_3WEEK"  	,"#,##0.#");	GridObj.SetNumberFormat("FRC_QTY" 			 	,"#,##0.#");	GridObj.SetNumberFormat("BASE_DAY" 				,"#,##0.#");	GridObj.SetNumberFormat("SALES_EXPT"			,"#,##0.#");	GridObj.SetNumberFormat("BASE_CP_DAY" 			,"#,###.0");	GridObj.SetNumberFormat("PRODUCE_TERM"  		,"#,###.0");	GridObj.SetNumberFormat("PRE_STOCK_DAY"  		,"###,##0.##");			//模熱薄 煎霜	GridObj.SetNumberFormat("TOT_SAFE_DAY"  		,"###,##0.##");	GridObj.SetNumberFormat("SAFE_STOCK_QTY"  		,"#,##0.#");	GridObj.SetNumberFormat("EVENT_QTY"  			,"#,##0.#");	GridObj.SetNumberFormat("TOT_SUPPLY_QTY"  		,"#,##0.#");	GridObj.SetNumberFormat("W0_BASE_STOCK"  		,"#,##0.#");	GridObj.SetNumberFormat("W0_PROD_QTY"  			,"#,##0.#");	GridObj.SetNumberFormat("W0_SUPPLY_QTY"  		,"#,##0.#");	GridObj.SetNumberFormat("PROD_DEMAND_QTY"  		,"#,##0.#");	GridObj.SetNumberFormat("PROD_PLAN_QTY"  		,"#,##0.#");	GridObj.SetNumberFormat("W1_PROD_PLAN"  		,"#,##0.#");	GridObj.SetNumberFormat("PROD_PLAN_SUB"  		,"#,##0.#");	GridObj.SetNumberFormat("PROD_PLAN_QTY2"  		,"#,##0.#");	GridObj.SetNumberFormat("PROD_PLAN_SAFE_QTY"  	,"#,##0.#");		//GridObj.SetColCellAlign('PRE_STOCK_DAY',        'right');	//Hidden 鏽歲  	GridObj.SetColHide("CRUD",true);																}	});          }   /*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛飛橦 '褻'蒂 援腦賊 轎 Fnc  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/   function GoSearch(service)    {       doQuery();   }  /*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛飛橦 '盪濰'蒂 援腦賊 轎 Fnc  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/function GoSave  (service) {				var GridObj = document.WiseGrid;	var servlet_url = Project_name+"/servlet/com.wisegrid.admin."+job_id;        GridObj.SetParam("mode", "save");	//剩啖還 高菟擊虜萇棻.( だ塭嘐攪 薑曖 睡碟 )	GridObj.SetParam("user_id", document.frm._user_id.value);	var cnfm_date = document.frm.cnfm_date.value;	GridObj.SetParam("cnfm_date", cnfm_date);				var in_paramKey = "cnfm_date";	var in_paramCode = cnfm_date;			GridObj.DoQuery(servlet_url, "WISEGRIDDATA_ALL");	return;}         /*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛羅廓簞 斜葬萄曖 褻 蘭葬蒂 轎 Fnc  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/   function doQuery()    {       var servlet_url = Project_name+"/servlet/com.wisegrid.admin."+job_id;       var cnfm_date = document.all.cnfm_date.value;       var chk_sort	 = "Y";      		if(document.frm.chk_sort.checked) {		chk_sort = "N";					}              //剩啖還 高菟擊虜萇棻.( だ塭嘐攪 薑曖 睡碟 )       GridObj.SetParam("mode", "search");       GridObj.SetParam("cnfm_date", cnfm_date);       GridObj.SetParam("chk_sort",	 chk_sort);       //GridObj.SetParam("in_to_date", in_to_date);       //GridObj.SetParam("in_mto_mts", in_mto_mts);       GridObj.DoQuery(servlet_url);   }/*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛等檜攪 褻萼 薑鼻瞳戲煎 諫猿腎賊 嫦儅腎朝 Event縑 渠и Fnc  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/    function GridEndQuery()     {        var endMode = GridObj.GetParam("mode");        var error_msg = '';                  if(endMode == "search") //褻萼 諫猿脹 唳辦        {            if(GridObj.GetStatus() == "true")             {                           				GridObj.SetGroupMerge('SALES_CAT03,SALES_CAT_SCM');			     				        	var row_cnt = GridObj.GetRowCount();				var colBGColor1='237|237|237';				var colBGColor2='255|255|255';				var color_flag ='1';    //斜瑜SALES_CAT03 滌煎 寥斜塭遴萄 儀鼻 滲唳 Ы楚 2014-11-12 檜蝓辨 蹂羶								GridObj.SetColHDBgColor('FRC_QTY',			'253|228|229'); 		        GridObj.SetColHDBgColor('BASE_DAY',			'253|228|229'); 		        GridObj.SetColHDBgColor('PRODUCE_TERM',		'253|228|229'); 		        GridObj.SetColHDBgColor('PRE_STOCK_DAY',	'253|228|229'); 		        GridObj.SetColHDBgColor('BASE_CP_DAY',		'253|228|229'); 		        GridObj.SetColHDBgColor('EVENT_QTY',		'253|228|229'); 		        GridObj.SetColHDBgColor('PROD_PLAN_QTY',	'253|228|229'); 		        GridObj.SetColHDBgColor('PROD_PLAN_QTY2',	'253|228|229'); 												for( var i=0 ;i<row_cnt ;i++) //瞪羹 Row虜躑 奩犒 и棻.		        {			        	if (color_flag =='1'){		        				        		GridObj.SetRowBgColor(i,colBGColor2);		        		if( i > 0 ){		        		 		if ( GridObj.GetCellValue('SALES_CAT_SCM',i) != GridObj.GetCellValue('SALES_CAT_SCM',i+1) ){		        									        							color_flag='2';		        				 }		        		}			        				        	}else{		        				        		GridObj.SetRowBgColor(i,colBGColor1);		        		if ( GridObj.GetCellValue('SALES_CAT_SCM',i) != GridObj.GetCellValue('SALES_CAT_SCM',i+1) ){		        									        							color_flag='1';		        			       					 }		        				        	}		      		        }                                                         } else {                 error_msg = GridObj.GetMessage();                 alert(error_msg);            					}			 	       	 			        }        else if(endMode == "save") {			if(GridObj.GetStatus() == "true") {// 				GridObj.focus();					} else {				var error_msg = GridObj.GetMessage();// 				alert(error_msg);						}						doQuery()   // 盪濰 諫猿 給嬴螢陽朝 飛橉 營褻 и棻.         }		checkCellColor();    }// 摹鷗и row縑 儅骯蹂羶橾 橾婪瞳辨function applyProdReq(){		var sel_data = GridObj.GetSelectedCells(); // 摹鷗и 睡碟曖 key諦 row蒂 陛螳螞棻	var i=0;	var rowNo;		var in_appl_date = delDateDelimiter(document.all.in_appl_date.value);	while(1) {		if (sel_data.split(",")[i*2+1] == null || sel_data.split(",")[i*2+1] == "")  // 渦檜鼻 等檜攪 橈棻			return;		else {			var rowNo = sel_data.split(",")[i*2+1];			//п渡 row縑 check蒂 и棻			GridObj.SetCellValue("PROD_REQ_DATE", rowNo, in_appl_date);		}		i++;	}}   /* EXCEL ???? */   function excelDown() {       var GridObj = document.WiseGrid;       //???? ???? ???? PC? ??? ????. SetColHide()? ??? ??? ???? ???.        GridObj.ExcelExport("", "", true, true);   }function GridCellClick(strColumnKey, nRow){	}function GridChangeCell(strColumnKey, nRow, nOldValue, nNewValue) {	    //alert("strColumnKey="+strColumnKey);	// 觼啪 晦遽營堅 滲唳衛 諦 儅骯в蹂榆 熱薑衛 煎霜檜 ぎ溥撿л..	 if(strColumnKey == 'FRC_QTY'||strColumnKey == 'BASE_CP_DAY'|| strColumnKey == 'PRODUCE_TERM'||strColumnKey == 'PRE_STOCK_DAY' ||	 strColumnKey == 'EVENT_QTY' || strColumnKey == 'BASE_DAY'){				Cal_Sales_Expt(nRow);		Cal_Tot_Safe_Day(nRow);		Cal_Safe_Stock_Qty(nRow);		Cal_Tot_Supply_Qty(nRow);		Cal_Prod_Demand_Qty(nRow);		Cal_Prod_Plan_Sub(nRow);			}}function Cal_Sales_Expt(nRow){		var frc_qty			 = Number(GridObj.GetCellValue("FRC_QTY", nRow));	var base_day		 = Number(GridObj.GetCellValue("BASE_DAY", nRow));		GridObj.SetCellValue("SALES_EXPT", nRow, frc_qty*base_day);}function Cal_Tot_Safe_Day(nRow){		var base_cp_day 	=  Number(GridObj.GetCellValue("BASE_CP_DAY", 	nRow));	var produce_term 	=  Number(GridObj.GetCellValue("PRODUCE_TERM", 	nRow));	var pre_stock_day 	=  Number(GridObj.GetCellValue("PRE_STOCK_DAY", nRow));		GridObj.SetCellValue("TOT_SAFE_DAY", nRow, base_cp_day + produce_term + pre_stock_day);}function Cal_Safe_Stock_Qty(nRow){		var frc_qty			 = Number(GridObj.GetCellValue("FRC_QTY", 		nRow));	var base_cp_day 	=  Number(GridObj.GetCellValue("BASE_CP_DAY", 	nRow));	var produce_term 	=  Number(GridObj.GetCellValue("PRODUCE_TERM", 	nRow));	var pre_stock_day 	=  Number(GridObj.GetCellValue("PRE_STOCK_DAY", nRow));	var tot = base_cp_day + produce_term + pre_stock_day;			GridObj.SetCellValue("SAFE_STOCK_QTY", nRow, frc_qty * tot);}	function Cal_Tot_Supply_Qty(nRow){	var sales_expt 		= Number(GridObj.GetCellValue("SALES_EXPT", nRow));	var safe_stock_qty 	= Number(GridObj.GetCellValue("SAFE_STOCK_QTY", nRow));	var event_qty		= Number(GridObj.GetCellValue("EVENT_QTY", nRow));		GridObj.SetCellValue("TOT_SUPPLY_QTY", nRow, sales_expt + safe_stock_qty + event_qty);}function Cal_Prod_Demand_Qty(nRow){	var tot_supply_qty  = Number(GridObj.GetCellValue("TOT_SUPPLY_QTY", nRow));	var w0_supply_qty	= Number(GridObj.GetCellValue("W0_SUPPLY_QTY", nRow));		GridObj.SetCellValue("PROD_DEMAND_QTY", nRow, tot_supply_qty - w0_supply_qty);}function Cal_Prod_Plan_Sub(nRow){	var prod_demand_qty = 	Number(GridObj.GetCellValue("PROD_DEMAND_QTY", nRow));	var w1_prod_plan	=	Number(GridObj.GetCellValue("W1_PROD_PLAN", nRow));		GridObj.SetCellValue("PROD_PLAN_SUB", nRow, w1_prod_plan - prod_demand_qty);}/*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛斜葬萄曖 餌檜鍔 褻瞰 Fnc  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/    function setGridAutoResize( tab_h, table_h ){                var maxWidthValue;        var maxHeightValue;                if (document.layers) {            //Nescape            maxWidthValue = window.innerWidth;            maxHeightValue = window.innerHeight;        }        if (document.all) {            //explore            maxWidthValue = document.body.clientWidth;            maxHeightValue = document.body.clientHeight;        }                 var tabHeightValue = Number(maxHeightValue) - Number(tab_h) ;         var tableHeightValue = Number(maxHeightValue) - Number(table_h) ;                 var search_h = document.frm.search_h.value;         if( search_menu.style.display == "none" )         {             tabHeightValue += Number(search_h);             tableHeightValue += Number(search_h);         }                 // 飛 size 蹴模 衛 飛橉 傘鼠 濛嬴 斜葬萄 觼晦陛 擠熱陛 腎賊 縑楝陛 釭嘎煎 斜 唳辦 鼠褻勒 1煎 撮た         // ==> 飛橉 渦檜鼻 蹴模腎雖 彊擠         if( tabHeightValue < 1 )             tabHeightValue = 1;         if( tableHeightValue < 1 )             tableHeightValue = 1;                 //tabPage1.style.height = tabHeightValue + "px";         //tbMain.style.height = tableHeightValue + "px";         document.WiseGrid.height = tableHeightValue + "px";             }    	/*忙式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式忖  弛っ衙橾熱 塽 餌瞪 綠蹴橾熱 爾薑  戌式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式式戎*/          function changeChecked(){    	    	var set_base_day 		= document.all.set_base_day.value;    	var set_pre_stock_day 	= document.all.set_pre_stock_day.value;    	    	var row_cnt = GridObj.GetRowCount();				for( var i=0 ;i<row_cnt ;i++) //瞪羹 Row虜躑 奩犒 и棻.		{		  if( set_base_day !== ""){		  	GridObj.SetCellValue("BASE_DAY",		i, set_base_day);		  }		  if( set_pre_stock_day !== ""){		  	GridObj.SetCellValue("PRE_STOCK_DAY",	i, set_pre_stock_day);		  }				}      }           function checkCellColor(){			var row_cnt = GridObj.GetRowCount();		for (var i=0; i<row_cnt; i++){				var flag =	GridObj.GetCellHiddenValue('PROD_PLAN_SAFE_QTY',i);					if( flag == '1')		GridObj.SetCellBgColor('PROD_PLAN_SAFE_QTY',i,'250|224|212');			}	}                     	