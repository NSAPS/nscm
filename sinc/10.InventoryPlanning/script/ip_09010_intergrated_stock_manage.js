//## 프로그램ID       : ip_09010_intergrated_stock_manage.js
//## 프로그램명      	 : 통합재고관리
//## 변경자           : 이강욱
//## 개발일자        	 : 2016-08-08 
//##
//## 관련 job file   : job_sinc_10_inventoryPlanning_08.xml
//## 관련 query file : query_sinc_ip_09010_intergrated_stock_manage.xml.xml
//##
//## REVISIONS
//## VER        DATE        AUTHOR    DESCRIPTION//## ---------  ----------  --------  ------------------------------------

//############################################################
/************************************************************************************************************************************/
/**********************************************  WiseGrid Java Script   *************************************************************/
/************************************************************************************************************************************/

//-----------------------------------------             전역 변수            ----------------------------------------------//
//var mode;														// WiseGrid 통신 시 전송 모드(search, save, ... etc)
var class_path = "com.wisegrid.admin.";							// 서블릿 패키지(class 파일 경로)
var job_id = 'ip_09010_intergrated_stock_manage';

var GridObj ; 									// WiseGrid 객체
var color_tot 		 = '234|234|234';			//합계 라인 배경색
var color_edit_col   = '255|253|208';
var color_sp 		 = '230|222|230'; 			//컬럼 구분선 배경색
var color_select_row = '141|232|141';			//라인 선택 배경색 
var colBg01 		 = '224|255|224';			//255|255|153
var colBg02 	     = '255|255|255';


/*┌──────────────────────────────────┐
  │그리드의 사이즈 조절 Fnc
  └──────────────────────────────────┘*/
function setGridAutoResize( tab_h, table_h ){
    
    var maxWidthValue;
    var maxHeightValue;
    
    if (document.layers) {
        //Nescape
        maxWidthValue   = window.innerWidth;
        maxHeightValue  = window.innerHeight;
    }
    if (document.all) {
        //explore
        maxWidthValue    = document.body.clientWidth;
        maxHeightValue   = document.body.clientHeight;
    } 
    
    var tabHeightValue   = Number(maxHeightValue) - Number(tab_h) ; 
    var tableHeightValue = Number(maxHeightValue) - Number(table_h) ; 
    
    var search_h = document.frm.search_h.value; 
    if( search_menu.style.display == "none" ) 
    { 
        tabHeightValue   += Number(search_h); 
        tableHeightValue += Number(search_h);   
    } 
    
    // 화면 size 축소 시 화면이 너무 작아 그리드 크기가 음수가 되면 에러가 나므로 그 경우 무조건 1로 세팅 
    // ==> 화면이 더이상 축소되지 않음 
    if( tabHeightValue < 1 ) 
        tabHeightValue = 1; 
    if( tableHeightValue < 1 ) 
        tableHeightValue = 1;
      
    //tabPage1.style.height = tabHeightValue + "px"; 

    document.WiseGrid.height = tableHeightValue + "px"; 
    //document.WiseGrid2.height = tableHeightValue - document.WiseGrid.height + "px";
}  

/*┌─────────────────────────────────────────────────────────────────────┐
  │WiseGrid 오브젝트가 생성되고 초기화된 후 발생하는 							│
  │JavaScript Event인 Initialize()를 받아 그리드의 헤더를 셋팅한다.			│
  └─────────────────────────────────────────────────────────────────────┘*/
function init() { 
	GridObj = document.WiseGrid;
	setProperty(GridObj);	//WiseGrid Default설정 부분 (WiseGrid_Property.js파일 내에 선언되어 있다.)
	setHeader(GridObj);  	//해더생성 
	setDefault();        	//화면 기본 설정 
}   
/*┌──────────────────────────────────┐
  │화면 기본 설정 부분.
  └──────────────────────────────────┘*/
function setDefault() { 

	GridObj.bRowSelectorIndex = true;				//Row Selector 영역에 Row Index를 보여준다.

    GridObj.nHDLineSize         = 10; //Header Size
    //GridObj.bHDMoving = true;		// 컬럼 헤더 위치 이동
    
    //헤더의 라인수를 설정한다. 
    GridObj.nHDLines = 2;   
   
    //선택된 셀의 글자색 지정한다.
	GridObj.strSelectedCellFgColor = '0|0|0';
	GridObj.strSelectedCellBgColor = '232|232|255'; 	//Drag로 선택된 셀의 배경색상을 변경할 수 있다
	GridObj.strActiveRowBgColor    = "232|245|213";     //선택된 행의 배경색상을 설정한다.	
    GridObj.strHDClickAction 	   = "select";        	//클릭한 컬럼의 셀을 선택가능하게 한다.
    GridObj.strMouseWheelAction	   = 'page';

	// Cell Font Setting
	GridObj.nCellFontSize = 9;		
       
}
       
/*┌──────────────────────────────────┐
  │해더생성
  └──────────────────────────────────┘*/ 
function setHeader(GridObj) {        

	GridObj.AddHeader("CNFM_DATE"	,"일자"			,"t_text" 	   	   ,100	    ,100     ,false); //0   
 	GridObj.AddHeader("CUR_STOCK"	,"금년재고"	    ,"t_number" 	   ,100	    ,80    ,false); //0
 	GridObj.AddHeader("LAST_STOCK"	,"전년재고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("CUR_CHGO"	,"금년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("LAST_CHGO"	,"전년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	
 	GridObj.AddHeader("CUR_STOCK2"	,"금년재고"	    ,"t_number" 	   ,100	    ,80    ,false); //0
 	GridObj.AddHeader("LAST_STOCK2"	,"전년재고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("CUR_CHGO2"	,"금년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("LAST_CHGO2"	,"전년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	
 	GridObj.AddHeader("CUR_STOCK3"	,"금년재고"	    ,"t_number" 	   ,100	    ,80    ,false); //0
 	GridObj.AddHeader("LAST_STOCK3"	,"전년재고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("CUR_CHGO3"	,"금년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("LAST_CHGO3"	,"전년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	
 	GridObj.AddHeader("CUR_STOCK4"	,"금년재고"	    ,"t_number" 	   ,100	    ,80    ,false); //0
 	GridObj.AddHeader("LAST_STOCK4"	,"전년재고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("CUR_CHGO4"	,"금년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("LAST_CHGO4"	,"전년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	
 	GridObj.AddHeader("CUR_STOCK5"	,"금년재고"	    ,"t_number" 	   ,100	    ,80    ,false); //0
 	GridObj.AddHeader("LAST_STOCK5"	,"전년재고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("CUR_CHGO5"	,"금년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
 	GridObj.AddHeader("LAST_CHGO5"	,"전년출고"	    ,"t_number"  	   ,100		,80    ,false); //0
	
	GridObj.AddGroup	("GUBN",    "면/스낵");			
	GridObj.AppendHeader("GUBN", 	"CUR_STOCK");
	GridObj.AppendHeader("GUBN", 	"LAST_STOCK");
	GridObj.AppendHeader("GUBN", 	"CUR_CHGO");
	GridObj.AppendHeader("GUBN",   	"LAST_CHGO");
	
	GridObj.AddGroup	("GUBN2",   "매입상품");			
	GridObj.AppendHeader("GUBN2", 	"CUR_STOCK2");
	GridObj.AppendHeader("GUBN2", 	"LAST_STOCK2");
	GridObj.AppendHeader("GUBN2", 	"CUR_CHGO2");
	GridObj.AppendHeader("GUBN2",   "LAST_CHGO2");
	
	GridObj.AddGroup	("GUBN3",   "수입상품");			
	GridObj.AppendHeader("GUBN3", 	"CUR_STOCK3");
	GridObj.AppendHeader("GUBN3", 	"LAST_STOCK3");
	GridObj.AppendHeader("GUBN3", 	"CUR_CHGO3");
	GridObj.AppendHeader("GUBN3",   "LAST_CHGO3");
	
	GridObj.AddGroup	("GUBN4",   "기타");			
	GridObj.AppendHeader("GUBN4", 	"CUR_STOCK4");
	GridObj.AppendHeader("GUBN4", 	"LAST_STOCK4");
	GridObj.AppendHeader("GUBN4", 	"CUR_CHGO4");
	GridObj.AppendHeader("GUBN4",   "LAST_CHGO4");
	
	GridObj.AddGroup	("GUBN5",   "계");			
	GridObj.AppendHeader("GUBN5", 	"CUR_STOCK5");
	GridObj.AppendHeader("GUBN5", 	"LAST_STOCK5");
	GridObj.AppendHeader("GUBN5", 	"CUR_CHGO5");
	GridObj.AppendHeader("GUBN5",   "LAST_CHGO5");
	
	GridObj.BoundHeader();	

	GridObj.SetColFix('CNFM_DATE'); 
	
	GridObj.SetColCellAlign('CNFM_DATE',        'center');
	
   	GridObj.SetNumberFormat("CUR_STOCK",       	"###,###.#");
    GridObj.SetNumberFormat("LAST_STOCK",       "###,###.#");
    GridObj.SetNumberFormat("CUR_CHGO",     	"###,###.#");
    GridObj.SetNumberFormat("LAST_CHGO",       	"###,###.#");
    GridObj.SetNumberFormat("CUR_STOCK2",       "###,###.#");
    GridObj.SetNumberFormat("LAST_STOCK2",      "###,###.#");
    GridObj.SetNumberFormat("CUR_CHGO2",     	"###,###.#");
    GridObj.SetNumberFormat("LAST_CHGO2",       "###,###.#");
    GridObj.SetNumberFormat("CUR_STOCK3",       "###,###.#");
    GridObj.SetNumberFormat("LAST_STOCK3",      "###,###.#");
    GridObj.SetNumberFormat("CUR_CHGO3",     	"###,###.#");
    GridObj.SetNumberFormat("LAST_CHGO3",       "###,###.#");
    GridObj.SetNumberFormat("CUR_STOCK4",       "###,###.#");
    GridObj.SetNumberFormat("LAST_STOCK4",      "###,###.#");
    GridObj.SetNumberFormat("CUR_CHGO4",     	"###,###.#");
    GridObj.SetNumberFormat("LAST_CHGO4",       "###,###.#");
    GridObj.SetNumberFormat("CUR_STOCK5",       "###,###.#");
    GridObj.SetNumberFormat("LAST_STOCK5",      "###,###.#");
    GridObj.SetNumberFormat("CUR_CHGO5",     	"###,###.#");
    GridObj.SetNumberFormat("LAST_CHGO5",       "###,###.#");
   
 
}
/*┌──────────────────────────────────┐
  │데이터 조회가 정상적으로 완료되면 발생되는 Event에 대한 Fnc
  └──────────────────────────────────┘*/
function GridEndQuery() 
{
	
    var endMode = GridObj.GetParam("mode");
    var error_msg = '';
      
    if(endMode == "search") //조회가 완료된 경우
    {
        if(GridObj.GetStatus() == "true") 
        {        
        	
        	var row = GridObj.GetRowCount();            	
        	if (row == 0) return;
        
        	GridSetMerge();
         
        } else    
        { 
            error_msg = GridObj.GetMessage(); 
            alert(error_msg);            
		}
    }
	
}

/*┌──────────────────────────────────┐
  │그리드의 원 클릭 이벤트
  └──────────────────────────────────┘*/
       
/*┌──────────────────────────────────┐
  │화면에 '조회'를 누르면 호출 Fnc
  └──────────────────────────────────┘*/
function GoSearch(service) 
{
    doQuery();
}

/*┌──────────────────────────────────┐
  │하부 그리드 조회 WD1 더블클릭
  └──────────────────────────────────┘*/
function GoSave(service) {	

	doSave();	
	
};

/*┌──────────────────────────────────┐
  │DW 1 조회 쿼리를 호출 Fnc
  └──────────────────────────────────┘*/
function doQuery() 
{
   var start_date	    = document.frm.start_date.value;
   var end_date	        = document.frm.end_date.value;
   //start_date 			= start_date.replace(/-/g,"");
   //end_date 			= end_date.replace(/-/g,"");
 
   var user_id			= document.frm._user_id.value;
   var selected_type	= document.frm.selected_type.value; 
	
       	
   var servlet_url      = Project_name+"/servlet/com.wisegrid.admin."+job_id;
 
   //넘겨줄 값들을만든다.( 파라미터 정의 부분 )
   GridObj.SetParam("mode",           	"search");
   GridObj.SetParam("start_date",   	start_date);
   GridObj.SetParam("end_date",       	end_date);
   GridObj.SetParam("user_id",     		user_id);  
   GridObj.SetParam("selected_type", 	selected_type); 
  	
   GridObj.DoQuery(servlet_url);       
}


/*┌──────────────────────────────────┐
  │그리드의 원 클릭 이벤트
  └──────────────────────────────────┘*/
function GridCellClick(strColumnKey, nRow) {

}

function GridSetMerge(){	
	
	GridObj.AddSummaryBar('SUMMARY', '평균', 'summaryall', 'sum', 'CUR_STOCK,LAST_STOCK,CUR_CHGO,LAST_CHGO,CUR_STOCK2,LAST_STOCK2,CUR_CHGO2,LAST_CHGO2,' +
	      	 			'CUR_STOCK3,LAST_STOCK3,CUR_CHGO3,LAST_CHGO3,CUR_STOCK4,LAST_STOCK4,CUR_CHGO4,LAST_CHGO4,CUR_STOCK5,LAST_STOCK5,CUR_CHGO5,LAST_CHGO5');
	
	var rowcount = GridObj.GetRowCount();
	var cnt_cur_chgo 	= 0;
	var cnt_last_chgo	= 0;
	for (var i=0; i<rowcount; i++){
		if(GridObj.GetCellValue('CUR_CHGO',i) == '0') cnt_cur_chgo += Number(1) ;
		if(GridObj.GetCellValue('LAST_CHGO',i) == '0') cnt_last_chgo += Number(1) ;
	}	
	
	var result 	= rowcount - cnt_cur_chgo ;
	var result2	= rowcount - cnt_last_chgo;
	
    	        
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_STOCK');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_STOCK');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_CHGO');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_CHGO');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_STOCK2');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_STOCK2');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_CHGO2');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_CHGO2');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_STOCK3');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_STOCK3');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_CHGO3');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_CHGO3');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_STOCK4');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_STOCK4');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_CHGO4');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_CHGO4');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_STOCK5');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_STOCK5');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','CUR_CHGO5');
//    GridObj.SetSummaryBarFunction('SUMMARY','average','LAST_CHGO5');   	

   	
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_STOCK',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_STOCK',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_STOCK',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_STOCK',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_CHGO',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_CHGO',0).replace(/,/g,"")/result));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_CHGO',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_CHGO',0).replace(/,/g,"")/result2));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_STOCK2',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_STOCK2',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_STOCK2',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_STOCK2',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_CHGO2',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_CHGO2',0).replace(/,/g,"")/result));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_CHGO2',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_CHGO2',0).replace(/,/g,"")/result2));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_STOCK3',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_STOCK3',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_STOCK3',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_STOCK3',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_CHGO3',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_CHGO3',0).replace(/,/g,"")/result));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_CHGO3',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_CHGO3',0).replace(/,/g,"")/result2));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_STOCK4',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_STOCK4',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_STOCK4',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_STOCK4',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_CHGO4',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_CHGO4',0).replace(/,/g,"")/result));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_CHGO4',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_CHGO4',0).replace(/,/g,"")/result2));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_STOCK5',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_STOCK5',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_STOCK5',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_STOCK5',0).replace(/,/g,"")/rowcount));
   	GridObj.SetSummaryBarValue('SUMMARY','CUR_CHGO5',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','CUR_CHGO5',0).replace(/,/g,"")/result));
   	GridObj.SetSummaryBarValue('SUMMARY','LAST_CHGO5',0, Math.round(GridObj.GetSummaryBarValue('SUMMARY','LAST_CHGO5',0).replace(/,/g,"")/result2));

	GridObj.SetSummaryBarColor('SUMMARY', '0|153|0', color_tot);
}
