//## 프로그램ID      : ip_01110_Baeksansu_Stock_Trace.js
//## 프로그램명      : 백산수 재고추적 조회
//## 변경자자        : 이강욱
//## 개발일자        : 2015-01-07 
//##
//## 관련 job file   : job_sinc_10_inventoryPlanning_04.xml
//## 관련 query file : query_sinc_10_inventoryPlanning_04.xml
//##
//## REVISIONS
//## VER        DATE        AUTHOR    DESCRIPTION
//## ---------  ----------  --------  ------------------------------------
//## 1.0        2014-01-07	이강욱		신규
//##
//############################################################
/************************************************************************************************************************************/
/**********************************************  WiseGrid Java Script   *************************************************************/
/************************************************************************************************************************************/

//-----------------------------------------             전역 변수            ----------------------------------------------//
//var mode;														// WiseGrid 통신 시 전송 모드(search, save, ... etc)
var class_path = "com.wisegrid.admin.";							// 서블릿 패키지(class 파일 경로)
var job_id = 'ip_01110_Baeksansu_Stock_Trace';

var GridObj ; 													// WiseGrid 객체
var color_tot = '234|234|234';			//합계 라인 배경색
var color_edit_col = '255|253|208';
var color_sp = '230|222|230'; 			//컬럼 구분선 배경색
var color_select_row = '141|232|141';	//라인 선택 배경색 
var colBg01 = '224|255|224';			//255|255|153
var colBg02 = '255|255|255';


/*┌──────────────────────────────────┐
  │그리드의 사이즈 조절 Fnc
  └──────────────────────────────────┘*/
    function setGridAutoResize( tab_h, table_h ){
        
        var maxWidthValue;
        var maxHeightValue;
        
        if (document.layers) {
            //Nescape
            maxWidthValue  = window.innerWidth;
            maxHeightValue = window.innerHeight;
        }
        if (document.all) {
            //explore
            maxWidthValue  = document.body.clientWidth;
            maxHeightValue = document.body.clientHeight;
        } 
        
        var tabHeightValue   = Number(maxHeightValue) - Number(tab_h) ; 
        var tableHeightValue = Number(maxHeightValue) - Number(table_h) ; 
        
        var search_h = document.frm.search_h.value; 
        if( search_menu.style.display == "none" ) 
        { 
            tabHeightValue += Number(search_h); 
            tableHeightValue += Number(search_h);   
        } 
        
        // 화면 size 축소 시 화면이 너무 작아 그리드 크기가 음수가 되면 에러가 나므로 그 경우 무조건 1로 세팅 
        // ==> 화면이 더이상 축소되지 않음 
        if( tabHeightValue < 1 ) 
            tabHeightValue = 1; 
        if( tableHeightValue < 1 ) 
            tableHeightValue = 1;
          
        //tabPage1.style.height = tabHeightValue + "px"; 

        document.WiseGrid.height = tableHeightValue + "px"; 
        //document.WiseGrid2.height = tableHeightValue - document.WiseGrid.height + "px";
    }  

/*┌─────────────────────────────────────────────────────────────────────┐
  │WiseGrid 오브젝트가 생성되고 초기화된 후 발생하는 							│
  │JavaScript Event인 Initialize()를 받아 그리드의 헤더를 셋팅한다.			│
  └─────────────────────────────────────────────────────────────────────┘*/
function init() { 
	GridObj = document.WiseGrid;
	setProperty(GridObj);	//WiseGrid Default설정 부분 (WiseGrid_Property.js파일 내에 선언되어 있다.)
	setHeader(GridObj);  	//해더생성 
	setDefault();        	//화면 기본 설정 
}   
/*┌──────────────────────────────────┐
  │화면 기본 설정 부분.
  └──────────────────────────────────┘*/
function setDefault() { 

	//GridObj.bRowSelectorVisible = false;        		//로우 셀렉터를 WiseGrid에서 숨긴다,. 
	
	GridObj.bRowSelectorIndex = true;				//Row Selector 영역에 Row Index를 보여준다.
	
//	GridObj.SetColCellMerge('SALES_CAT02', true);
//	GridObj.SetColCellMerge('SALES_CAT03', true);
	
    GridObj.nHDLineSize         = 10; //Header Size
    
    //헤더의 라인수를 설정한다. 
    GridObj.nHDLines = 2;   
   
    //선택된 셀의 글자색 지정한다.
	GridObj.strSelectedCellFgColor = '0|0|0';
	GridObj.strSelectedCellBgColor = '232|232|255'; //Drag로 선택된 셀의 배경색상을 변경할 수 있다
	GridObj.strActiveRowBgColor = "232|245|213";    //선택된 행의 배경색상을 설정한다.	
    GridObj.strHDClickAction = "select";        	//클릭한 컬럼의 셀을 선택가능하게 한다.
    GridObj.strMouseWheelAction='page';

	// Cell Font Setting
	GridObj.nCellFontSize = 9;					// Font Size 9
       
}
       
/*┌──────────────────────────────────┐
  │해더생성
  └──────────────────────────────────┘*/ 
function setHeader(GridObj) {        

	//GridObj.AddHeader("CRUD"			,"CRUD"       	,"t_text" 		,100    ,0  ,false);  	
	//GridObj.AddHeader("SELECTED"		," "       		,"t_checkbox" 	,2		,21  ,true); //0

	
		GridObj.AddHeader("CNFM_DATE"	,"일자"		   ,"t_text" 	   ,100	    ,65     ,false); //0
		GridObj.AddHeader("GUBN"		,"구분"		   ,"t_text" 	   ,100	    ,0      ,false); //0
		GridObj.AddHeader("ITEM_ID"  	,"품목코드"	   ,"t_text"       ,100		,70     ,false); //0
		GridObj.AddHeader("ITEM_NAME"   ,"품목명"	   ,"t_text"       ,100		,140    ,false); //0
		
		//이도백하(연변) 하위그룹
		GridObj.AddHeader("STOCK_00"	,"기초재고"	   ,"t_number"	   ,100.3	,65     ,false); //0
		GridObj.AddHeader("PROD_00"     ,"생산량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		GridObj.AddHeader("ISSUE_IN" 	,"내수출고" 	   ,"t_number"     ,100.3   ,65     ,false); //0
		GridObj.AddHeader("ISSUE_00" 	,"대련출고" 	   ,"t_number"     ,100.3   ,65     ,false); //0
		//대련 하위그룹
		GridObj.AddHeader("STOCK_01"	,"기초재고"	   ,"t_number"	   ,100.3	,65     ,false); //0
		GridObj.AddHeader("PROD_01"     ,"입고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		GridObj.AddHeader("ISSUE_01" 	,"출고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		//평택부두
		GridObj.AddHeader("STOCK_02"	,"기초재고"	   ,"t_number"	   ,100.3	,65     ,false); //0
		GridObj.AddHeader("PROD_02"     ,"입고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		GridObj.AddHeader("ISSUE_02" 	,"출고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		//부산부두
		GridObj.AddHeader("STOCK_03"	,"기초재고"	   ,"t_number"	   ,100.3	,65     ,false); //0
		GridObj.AddHeader("PROD_03"     ,"입고량"	   ,"t_number"     ,100.3   ,65    ,false); //0
		GridObj.AddHeader("ISSUE_03" 	,"출고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		//농심
		GridObj.AddHeader("STOCK_04"	,"기초재고"	   ,"t_number"	   ,100.3	,65     ,false); //0
		GridObj.AddHeader("PROD_04"     ,"입고량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		GridObj.AddHeader("ISSUE_04" 	,"판매량"	   ,"t_number"     ,100.3   ,65     ,false); //0
		//합계
		GridObj.AddHeader("STOCK_05"	,"기초재고"	   ,"t_number"	   ,100.3	,0     ,false); //0
		GridObj.AddHeader("PROD_05"     ,"입고량"	   ,"t_number"     ,100.3   ,0     ,false); //0
		GridObj.AddHeader("ISSUE_05" 	,"입고량"	   ,"t_number"     ,100.3   ,0     ,false); //0
		
		
		
			/* 이중 해더 추가 */
		GridObj.AddGroup	("HD0",     "이도백하(연변)");			//그리드에 그룹을 등록한다. 
		GridObj.AppendHeader("HD0", 	"STOCK_00");
		GridObj.AppendHeader("HD0",     "PROD_00");
		GridObj.AppendHeader("HD0",     "ISSUE_IN");
		GridObj.AppendHeader("HD0",     "ISSUE_00");		
		
		GridObj.AddGroup	("HD1",     "대련");			
		GridObj.AppendHeader("HD1", 	"STOCK_01");
		GridObj.AppendHeader("HD1",     "PROD_01");
		GridObj.AppendHeader("HD1",     "ISSUE_01");
		
		GridObj.AddGroup	("HD2",     "평택");			
		GridObj.AppendHeader("HD2", 	"STOCK_02");
		GridObj.AppendHeader("HD2",     "PROD_02");
		GridObj.AppendHeader("HD2",     "ISSUE_02");
		
		GridObj.AddGroup	("HD3",     "부산");			
		GridObj.AppendHeader("HD3", 	"STOCK_03");
		GridObj.AppendHeader("HD3",     "PROD_03");
		GridObj.AppendHeader("HD3",     "ISSUE_03");
		
		GridObj.AddGroup	("HD4",     "농심");			
		GridObj.AppendHeader("HD4", 	"STOCK_04");
		GridObj.AppendHeader("HD4",     "PROD_04");
		GridObj.AppendHeader("HD4",     "ISSUE_04");
		
		GridObj.AddGroup	("HD5",     "합계");			
		GridObj.AppendHeader("HD5", 	"STOCK_05");
		GridObj.AppendHeader("HD5",     "PROD_05");
		GridObj.AppendHeader("HD5",     "ISSUE_05");
	
		GridObj.BoundHeader();	
		
		GridObj.SetColCellAlign('CNFM_DATE',     'center');
		GridObj.SetColCellAlign('GUBN',     	 'center');
		GridObj.SetColCellAlign('ITEM_ID',    	 'left');
		GridObj.SetColCellAlign('ITEM_NAME',     'left');
		
		GridObj.SetColCellAlign('STOCK_00',     'right');
		GridObj.SetColCellAlign('PROD_00',      'right');
		GridObj.SetColCellAlign('ISSUE_IN',     'right');
		GridObj.SetColCellAlign('ISSUE_00',     'right');
		GridObj.SetColCellAlign('STOCK_01',     'right');
		GridObj.SetColCellAlign('PROD_01',      'right');
		GridObj.SetColCellAlign('ISSUE_01',     'right');
		GridObj.SetColCellAlign('STOCK_02',     'right');
		GridObj.SetColCellAlign('PROD_02',      'right');
		GridObj.SetColCellAlign('ISSUE_02',     'right');
		GridObj.SetColCellAlign('STOCK_03',     'right');
		GridObj.SetColCellAlign('PROD_03',      'right');
		GridObj.SetColCellAlign('ISSUE_03',     'right');
		GridObj.SetColCellAlign('STOCK_04',     'right');
		GridObj.SetColCellAlign('PROD_04',      'right');
		GridObj.SetColCellAlign('ISSUE_04',     'right');
		GridObj.SetColCellAlign('STOCK_05',     'right');
		GridObj.SetColCellAlign('PROD_05',      'right');
		GridObj.SetColCellAlign('ISSUE_05',     'right');
		
		GridObj.SetNumberFormat("STOCK_00",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_00",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_IN",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_00",    	"###,###.#");
		GridObj.SetNumberFormat("STOCK_01",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_01",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_01",    	"###,###.#");
		GridObj.SetNumberFormat("STOCK_02",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_02",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_02",    	"###,###.#");
		GridObj.SetNumberFormat("STOCK_03",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_03",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_03",    	"###,###.#");
		GridObj.SetNumberFormat("STOCK_04",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_04",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_04",    	"###,###.#");
		GridObj.SetNumberFormat("STOCK_05",    	"###,###.#");
		GridObj.SetNumberFormat("PROD_05",    	"###,###.#");
		GridObj.SetNumberFormat("ISSUE_05",    	"###,###.#");
		
}
/*┌──────────────────────────────────┐
  │데이터 조회가 정상적으로 완료되면 발생되는 Event에 대한 Fnc
  └──────────────────────────────────┘*/
function GridEndQuery() {
	
	
	var mode = GridObj.GetParam("mode");
	var error_msg = '';

	 if(mode == "search") //조회가 완료된 경우
        {
            if(GridObj.GetStatus() == "true") 
            {    
            	    
            GridObj.SetGroupMerge('CNFM_DATE'); 
            //GridObj.AddSummaryBar('SUMMARY', '소계', 'CNFM_DATE', 'sum', 'STOCK_00,PROD_00,ISSUE_IN,ISSUE_00,STOCK_01,PROD_01,ISSUE_01');     
    		GridObj.AddSummaryBar('SUMMARY_ALL', '합계', 'summaryall', 'sum', 'PROD_00,ISSUE_IN,ISSUE_00,PROD_01,ISSUE_01,PROD_02,ISSUE_02,'+
    		'PROD_03,ISSUE_03,PROD_04,ISSUE_04,PROD_05,ISSUE_05');
    		//GridObj.SetSummaryBarColor('SUMMARY','0|153|0', color_tot); 
         	GridObj.SetSummaryBarColor('SUMMARY_ALL','0|153|0', color_tot); 
         	
            } else    
            { 
                error_msg = GridObj.GetMessage(); 
                alert(error_msg);            
			}
        }          

}


/*┌──────────────────────────────────┐
  │그리드의 원 클릭 이벤트
  └──────────────────────────────────┘*/
               
/*┌──────────────────────────────────┐
  │화면에 '조회'를 누르면 호출 Fnc
  └──────────────────────────────────┘*/
  function GoSearch(service){
  	
//    var insel_prty	    = document.all.insel_prty.value;
//    var in_item_id	    = document.all.in_item_id.value;
//    var in_item_name	= document.all.in_item_name.value;
//    var sel_gubn 	    = document.frm.sel_gubn.value;
    
//	GridObj = document.WiseGrid;
//	GridObj.ClearGrid();
//	setHeader(GridObj);    
	
    doQuery();
}
/*┌──────────────────────────────────┐
  │하부 그리드 조회 WD1 더블클릭
  └──────────────────────────────────┘*/
 
   
// 데이터 저장
function GoSave  (service) {

//   	var servlet_url = Project_name+"/servlet/com.wisegrid.admin."+job_id;
//    
//	GridObj.SetParam("mode", "save");
//	GridObj.SetParam("user_id", document.frm._user_id.value);  	// user_id
//
//	GridObj.DoQuery(servlet_url, "CRUD");
//	GridObj.DoQuery(servlet_url, "CRUD");
	//넘겨줄 값들을만든다.( 파라미터 정의 부분 )
	// user_id
	
//	//WiseGrid이 서버와 통신시에 데이터를 전달하는 메서드입니다. 통신이 성공하면 true를 반환합니다.

}

/*┌──────────────────────────────────┐
  │DW 1 조회 쿼리를 호출 Fnc
  └──────────────────────────────────┘*/
   function doQuery() 
   {

       var start_date	    = document.all.start_date.value.replace(/-/g,"");   
       var end_date	        = document.all.end_date.value.replace(/-/g,"");  
       var search_item	    = document.all.search_item.value;
      
       var servlet_url      = Project_name+"/servlet/com.wisegrid.admin."+job_id;
       
       //넘겨줄 값들을만든다.( 파라미터 정의 부분 )
       GridObj.SetParam("mode",            		"search");
       GridObj.SetParam("start_date",     		start_date);
       GridObj.SetParam("end_date",      		end_date);
        GridObj.SetParam("search_item",      	search_item);

	   GridObj.DoQuery(servlet_url);       
   }


function GridCellClick(){ //개체가 없다는 오류 해결 구문(Service.do)
	
}

